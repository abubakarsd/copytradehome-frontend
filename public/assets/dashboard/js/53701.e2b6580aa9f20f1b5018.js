"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[53701],{586190:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>h});var s=i(729193),r=i(950808),n=i(376596),o=i(277637),l=i(266150);const a=s.t(null,void 0,i(103107)),c=5e3;function h(e,t){(0,l.isFeaturesetEnabled)("popup_hints")&&!n.CheckMobile.any()&&Promise.all([i.e(50865),i.e(72454),i.e(32387),i.e(77588)]).then(i.bind(i,614572)).then((i=>{const s=new i.ChartEventHintRenderer(e),n=a.format({shortcut:(0,o.humanReadableHash)(o.Modifiers.Mod+86)});let l=null;s.show(n,(()=>{null!==l&&(clearTimeout(l),l=null,r.setValue(t,!0,{forceFlush:!0}))})),l=setTimeout((()=>{l=null,s.hide()}),c)}))}},818472:(e,t,i)=>{i.d(t,{trackChartDrawingCreation:()=>r});var s=i(637581);function r(e,t){(0,s.getTracker)().then((i=>{i&&i.trackChartDrawingCreation(e,t)}))}},140677:(e,t,i)=>{i.d(t,{trackDrawingToolSelected:()=>c});var s=i(187614),r=i(49833),n=i(637581),o=i(276978),l=i(654049);const a="DrawingToolSelected";function c(e,t){void 0!==t&&function(e){return(0,s.isStudyLineToolName)(e)||(0,s.isLineToolName)(e)||(0,r.toolIsCursor)(e)||(0,r.toolIsEraser)(e)||(0,r.toolIsMeasure)(e)}(e)&&(0,o.shouldAffectUser)(a,l.sparseUsersTrackingCoefficient)&&(0,n.getTracker)().then((i=>{i&&(e="performance"===e?"magic":e,i.trackDrawingToolSelected(e,t))}))}},888720:(e,t,i)=>{i.d(t,{ActionDelegate:()=>r});var s=i(875500);class r extends s.Delegate{constructor(e){super(),this._onStartListening=null,this._onStopListening=null,this._onStartListening=e||null}subscribe(e,t,i){const s=0===this._listeners.length;super.subscribe(e,t,i),s&&this._listeners.length>0&&this._onStartListening&&(this._onStopListening=this._onStartListening())}unsubscribe(e,t){const i=0===this._listeners.length;super.unsubscribe(e,t),!i&&0===this._listeners.length&&this._onStopListening&&(this._onStopListening(),this._onStopListening=null)}unsubscribeAll(e){const t=0===this._listeners.length;super.unsubscribeAll(e),!t&&0===this._listeners.length&&this._onStopListening&&(this._onStopListening(),this._onStopListening=null)}destroy(){this._onStopListening&&(this._onStopListening(),this._onStopListening=null),super.destroy()}}},23589:(e,t,i)=>{i.d(t,{alignToStep:()=>n});var s=i(712745),r=i.n(s);function n(e,t){return r()(e).div(t).round(0,r().roundHalfUp).mul(t).toNumber()}},858054:(e,t,i)=>{i.d(t,{LimitedPrecisionNumericFormatter:()=>r});var s=i(148544);class r{constructor(e,t){this._precision=e??1,this._numericFormatter=new s.NumericFormatter({precision:this._precision,ignoreLocaleNumberFormat:t})}format(e,t){const i=e.toFixed(this._precision),s=Math.pow(10,-this._precision);return this._numericFormatter.format(Math.max(parseFloat(i),s),t)}parse(e,t){const i=this._numericFormatter.parse(e,t);return i.res?{res:!0,value:i.value,suggest:this.format(i.value)}:i}}},726981:(e,t,i)=>{i.d(t,{LevelsProperty:()=>P});var s=i(436492),r=i(209539),n=i(385955),o=i(193867),l=i(253193);const a={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}}
;function c(e,t,i,s){return s.push(i[t]),s}function h(e,t,i,s){return s[t]=i[e],s}function u(){return[]}function d(){return{}}function p(e,t,i){return i.prefixes.forEach((s=>{const r=s+"level";for(let s=i.range[0];s<=i.range[1];s++)if(e[r+s]&&(0,n.isSameType)(e[r+s],t.typecheck())){let n=t.tpl();i.names.forEach(((i,o)=>{n=t.fill(""+o,i,e[r+s],n)})),e[r+s]=n}})),e}function _(e,t,i){return i(e,{tpl:d,fill:h,typecheck:t.typecheck.unpack},t)}class P extends o.DefaultProperty{constructor(e){const{levelsIterator:t=p,map:i={},...s}=e,r={...a,...i};s.state&&(s.state=_(s.state,r,t)),super(s),this._map=r,this._levelsIterator=t}state(e,t,i){const s=super.state(e,t);return i?s:(r=s,n=this._map,(0,this._levelsIterator)(r,{tpl:u,fill:c,typecheck:n.typecheck.pack},n));var r,n}preferences(){return(0,o.extractState)(this.state(this._excludedDefaultsKeys,void 0,!0),this._allDefaultsKeys)}applyTemplate(e,t){this.mergeAndFire((0,o.extractState)((0,r.default)((0,s.default)(t),_(e,this._map,this._levelsIterator)),this._allStateKeys,this._excludedTemplateKeys))}saveDefaults(){this._useUserPreferences&&(0,l.saveDefaults)(this._defaultName,this.preferences())}clone(){return new P(this._options())}merge(e,t){return super.merge(this._map?_(e,this._map,this._levelsIterator):e,t)}_options(){return{...super._options(),map:{...this._map},levelsIterator:this._levelsIterator}}}},598237:(e,t,i)=>{i.d(t,{LineToolBrushBase:()=>o});var s=i(185842),r=i(365737),n=i(168509);class o extends r.LineDataSource{constructor(){super(...arguments),this._hasEditableCoordinates=new n.WatchedValue(!1),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}hasOnlyOnePoint(){return 1===this._points.length}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,s.ensureNotNull)(this.pointToScreenPoint(t));if((0,s.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},373391:(e,t,i)=>{i.d(t,{LineToolElliott:()=>p,LineToolElliottCorrection:()=>x,LineToolElliottDoubleCombo:()=>b,LineToolElliottImpulse:()=>g,LineToolElliottTriangle:()=>f,LineToolElliottTripleCombo:()=>v});var s=i(729193),r=i(913947),n=i(365737),o=i(657130),l=i(193867),a=i(23439),c=i(965947);const h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],u=new r.TranslatedString("change Elliott degree",s.t(null,void 0,i(206872))),d=[{value:0,title:s.t(null,void 0,i(452353))},{value:1,title:s.t(null,void 0,i(413742))},{value:2,title:s.t(null,void 0,i(315651))},{value:3,title:s.t(null,void 0,i(922838))},{value:4,title:s.t(null,void 0,i(669188))},{value:5,title:s.t(null,void 0,i(435687))},{value:6,title:s.t(null,void 0,i(849872))},{value:7,title:s.t(null,void 0,i(752158))},{value:8,title:s.t(null,{context:"wave"},i(870562))},{value:9,title:s.t(null,{context:"wave"},i(242762))},{value:10,
title:s.t(null,void 0,i(551334))},{value:11,title:s.t(null,void 0,i(167813))},{value:12,title:s.t(null,void 0,i(438688))},{value:13,title:s.t(null,void 0,i(634095))},{value:14,title:s.t(null,void 0,i(196628))}];class p extends n.LineDataSource{constructor(e,t,s,r){super(e,t??p.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=4,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,33518)).then((e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])}))}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}async additionalActions(e){return{actions:[new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:s.t(null,void 0,i(407978)),subItems:h.map((t=>{const i=d.filter((e=>e.value===t))[0];return new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,u,c.lineToolsDoNotAffectChartInvalidation)}}})}))}})],placement:"CustomAction"}}label(e){const t=h.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return d}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliott",state:t,theme:e});return this._configureProperties(i),i}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,194562))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("linesColors",3)}}class _ extends p{pointsCount(){return 6}}
const P=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class g extends _{constructor(e,t,i,s){super(e,t??g.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return P}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottimpulse",state:t,theme:e});return this._configureProperties(i),i}}const m=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class f extends _{constructor(e,t,i,s){super(e,t??f.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return m}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliotttriangle",state:t,theme:e});return this._configureProperties(i),i}}const C=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class v extends _{constructor(e,t,i,s){super(e,t??v.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return C}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliotttriplecombo",state:t,theme:e});return this._configureProperties(i),i}}class y extends p{pointsCount(){return 4}}const w=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class x extends y{constructor(e,t,i,s){super(e,t??x.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return w}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottcorrection",state:t,theme:e});return this._configureProperties(i),i}}const T=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class b extends y{constructor(e,t,i,s){super(e,t??b.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return T}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottdoublecombo",state:t,theme:e});return this._configureProperties(i),i}}},151713:(e,t,i)=>{i.d(t,{LineToolFibWedgeBase:()=>l});var s=i(185842),r=i(657415),n=i(576134),o=i(168509);class l extends n.InplaceTextLineDataSource{constructor(){super(...arguments),this._hasEditableCoordinates=new o.WatchedValue(!1)}pointsCount(){return 3}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let n=t.subtract(e);n.length()<=0&&(n=new r.Point(1,0)),t=e.add(n.normalized().scaled(i));const o=(0,
s.ensureNotNull)(this.screenPointToPoint(t)),l=this._pointsProperty.childs().points[1];l.childs().price.setValue(o.price),l.childs().bar.setValue(o.index)}else{const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const n=t.subtract(e).length();let o=i.subtract(e);o.length()<=0&&(o=new r.Point(1,0)),i=e.add(o.normalized().scaled(n));const l=(0,s.ensureNotNull)(this.screenPointToPoint(i)),a=this._pointsProperty.childs().points[2];a.childs().price.setValue(l.price),a.childs().bar.setValue(l.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let r=(0,s.ensureNotNull)(this.pointToScreenPoint(e));const n=i.subtract(t).length(),o=r.subtract(t).normalized();r=t.add(o.scaled(n));const l=(0,s.ensureNotNull)(this.ownerSource()),a=(0,s.ensureNotNull)(l.firstValue()),c=(0,s.ensureNotNull)(this.priceScale()).coordinateToPrice(r.y,a);e={index:Math.round(this._model.timeScale().coordinateToIndex(r.x)),price:c}}return super.addPoint(e)}editableTextProperties(){(0,s.assert)(!1,"unexpected method call")}}},292865:(e,t,i)=>{i.d(t,{createPropertiesObject:()=>l});var s=i(385955),r=i(726981);function n(e,t,i){for(const r of Object.keys(e.levels??{}))if(e.levels[r]&&(0,s.isSameType)(e.levels[r],t.typecheck())){let s=t.tpl();i.names.forEach(((i,n)=>{s=t.fill(""+n,i,e.levels[r],s)})),e.levels[r]=s}return e}class o extends r.LevelsProperty{constructor(e,t,i){super({defaultName:e,state:i,map:{names:["width","color","visible"]},levelsIterator:n,theme:t})}}function l(e,t,i){return new o(e,t,i)}},855191:(e,t,i)=>{i.d(t,{LineToolGannComplex:()=>u});var s=i(657415),r=i(185842),n=i(858054),o=i(365737),l=i(464303),a=i(292865),c=i(23439),h=i(880753);class u extends o.LineDataSource{constructor(e,t,s,r){super(e,t??u.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,this._scaleRatioFormatter=new n.LimitedPrecisionNumericFormatter(7),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,479142)).then((({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}));const o=this.properties();this._adjustScaleRatio(o),o.subscribe(this,this._adjustScaleRatio),o.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions.push("scaleRatio"),o.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){1===e&&(this._points.length>=this.pointsCount()?setTimeout((()=>this._migratePoint())):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties()
;e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const s=super.addPoint(e,t,i),n=this.priceScale();return!(0,r.ensureNotNull)(n).isLog()&&s&&this._correctFirstPoint(),s}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,r.ensureNotNull)(i).isLog()||(this._points[1]={...e,interval:this._model.mainSeries().interval()},this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let s=0;s<i;s++){const i=t.levels.childs()[s].childs();e.push({index:s,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let s=0;s<i;s++){const i=t.fanlines.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let s=0;s<i;s++){const i=t.arcs.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:s}=e.labelsStyle.childs(),r=e.levels.childCount();return{textColor:e.levels.childs()[r-1].childs().color.value(),font:h.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:s.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}static createProperties(e,t){const i=(0,a.createPropertiesObject)("linetoolganncomplex",e,t);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,742648)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("scaleRatio",1);const t=[],i=[],s=e.childs();{const e=s.levels.childCount();for(let r=0;r<e;r++){const e=s.levels.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.fanlines.childCount();for(let r=0;r<e;r++){const e=s.fanlines.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.arcs.childCount();for(let r=0;r<e;r++){const e=s.arcs.childs()[r].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,l.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const s=this._points[e],r=0===e?this._points[1]:this._points[0],n=s.price-r.price>0,o=s.index-r.index>0;let l=n&&!o||!n&&o?-1:1;0===e&&(l=-l),s.price=r.price+l*t*i,this._pointChanged.fire(e)}this._normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,r.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const n=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),l=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),a=new s.Point(Math.cos(e),-Math.sin(e)),c=a.normalized(),h=c.x<0?-1:1,u=c.y<0?-1:1;return[n.addScaled(a,l),n.add(new s.Point(5*l*h,5*l*u))]}_calcAngle(){const[e,t]=this.points(),i=(0,r.ensureNotNull)(this.pointToScreenPoint(e));let s=(0,r.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(s.length()>0){s=s.normalized();let e=Math.acos(s.x);return s.y>0&&(e=-e),e}return null}}},403288:(e,t,i)=>{i.d(t,{LineToolImage:()=>L,buildAbsoluteUserImageUrl:()=>b});var s=i(185842),r=i(657415),n=i(77357),o=i(168509),l=i(193867),a=i(603550),c=i(365737),h=i(316746),u=i(950808),d=i(858328),p=i(140677),_=i(302358),P=i(586190),g=i(322868),m=i(49833);async function f(e,t){return async function(e){
const[t]=await Promise.all([Promise.all([i.e(45443),i.e(64116),i.e(98115),i.e(57032),i.e(46970),i.e(50865),i.e(48072),i.e(75828),i.e(97627),i.e(74354),i.e(86834),i.e(66446),i.e(30468),i.e(32140),i.e(18002),i.e(32387),i.e(67534),i.e(99331),i.e(37877)]).then(i.bind(i,422752))]);return t.renderImageDialog(e)}({onConfirm:e,onClose:t})}let C=null;function v(e){if("LineToolImage"!==e)return C?.then((e=>e())),void(C=null);window.is_authenticated||(0,m.resetToCursor)(!0),(0,_.runOrSigninWithFeature)((()=>{const e="LineToolImage";m.tool.setValue(e),(0,p.trackDrawingToolSelected)(e,"Left panel"),C=f(y,(()=>{C?.then((e=>e())),C=null,m.tool.value()===e&&(0,m.resetToCursor)(!0)})),(0,d.trackEvent)("Image","Open image dialog")}),{feature:"drawings",source:"Change drawing tool state"})}function y(e){const t=(0,g.chartWidgetCollectionService)();if(null===t)return;const i=!Boolean(u.getBool("hint.pasteImage")),r=t.activeChartWidget.value();r.model().pasteImageAsLineTool(e.url,e.blobUrl,(0,s.ensureNotNull)(r.model().model().paneForSource(r.model().mainSeries())),e.transparency),i&&(0,P.showPasteLineToolHint)(t.getContainer(),"hint.pasteImage")}const w=(0,n.getLogger)("Chart.LineToolImage");function x(e){return e.toLowerCase().startsWith("blob:")}const T=window.AWS_BBS3_DOMAIN;function b(e){if(x(e))return e;const t=new URL(e,T),i=new URL(t.pathname,T);if("/"===i.pathname)return null;const s=i.toString();return t.toString()!==s?null:s}function S(e){return e.toLowerCase().startsWith("data:")?e:new URL(e).pathname}class L extends c.LineDataSource{constructor(e,t,s,r){super(e,t||L.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._hasEditableCoordinates=new o.WatchedValue(!1),this._image=null,this._originPoint=4;const n=this.properties().childs().url;this._absoluteUserImageUrl=new a.Property(b(this.properties().childs().url.value())??""),this._absoluteUserImageUrl.subscribe(this,(e=>{const t=e.value();if(x(t))return;const i=b(t);null!==i&&n.setValue(S(i))})),n.subscribe(this,(()=>{const e=b(n.value());null!==e&&this._absoluteUserImageUrl.setValue(e)})),this._loadImage(),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,985333)).then((({ImagePaneView:t})=>{this._setPaneViews([new t(this,e)])})),this.properties().childs().url.subscribe(this,(()=>{this._loadImage()}))}absoluteUserImageUrl(){return this._absoluteUserImageUrl}cssWidth(){return this.properties().childs().cssWidth.value()}cssHeight(){return this.properties().childs().cssHeight.value()}angle(){return this.properties().childs().angle.value()}originPoint(){return this._originPoint}dOffsetX(){return this._dOffsetX||0}pointsCount(){return 1}name(){return"Image"}image(){return this._image}setBlobImageUrl(e){this._image||(this._createImage(e),this._blobUrl=e)}getChangePointForSync(e){return null}pointToScreenPoint({index:e,price:t},i,n){const o=this._model.timeScale(),l=(0,s.ensureNotNull)(i?i.priceScale():this.priceScale()),a=(0,
s.ensure)((i??this.ownerSource())?.firstValue()),c=o.indexToCoordinate(e)+(n??0),h=l.priceToCoordinate(t,a);return new r.Point(c,h)}setPoint(e,t,i){if(null===this._image)return;const{width:r,height:n}=this._image,o=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),l=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0],void 0,this.dOffsetX())),a=Math.max(Math.abs(l.x-o.x)/r,Math.abs(l.y-o.y)/n),c=Math.round(r*a),h=Math.round(n*a),u=this.properties().childs();u.cssWidth.setValue(c),u.cssHeight.setValue(h),this.propertiesChanged()}startChanging(e,t){super.startChanging(e,t),this._changeOriginPoint(L._oppositePoints[e])}endChanging(e,t){return this._changeOriginPoint(4),super.endChanging(e,t)}getPoint(){return null}syncLineStyleState(){const e=super.syncLineStyleState();return!e.url&&this._blobUrl&&(e.blobUrl=this._blobUrl),e}restoreExternalState(e){const{blobUrl:t,...i}=e;t&&this.setBlobImageUrl(t),super.restoreExternalState(i)}isSavedInChart(){return super.isSavedInChart()&&""!==this.absoluteUserImageUrl().value()}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolimage",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,588481))).ImageDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("url")||e.addChild("url",new a.Property("")),e.addExcludedKey("url",1),e.addExcludedKey("cssWidth",1),e.addExcludedKey("cssHeight",1),e.addExcludedKey("angle",1)}_loadImage(){const e=this.properties(),t=(0,s.ensureDefined)(e.child("url")).value();t&&this._createImage(t)}_changeOriginPoint(e){const t=this.originPoint(),i=4===t?L._correctOriginDirections[e]:L._correctOriginDirections[L._oppositePoints[t]],n=this.properties().childs().cssWidth.value()/2,o=this.properties().childs().cssHeight.value()/2,[l]=this._points,a=(0,s.ensureNotNull)(this.pointToScreenPoint(l)),c=new r.Point(a.x+n*i[0],a.y+o*i[1]),h=(0,s.ensureNotNull)(this.screenPointToPoint(c));this._dOffsetX=4===t?c.x-(0,s.ensureNotNull)(this.pointToScreenPoint(h)).x:void 0,l.index=h.index,l.price=h.price,this._originPoint=e}_createImage(e){const t=x(e),i=b(e);if(null===i)return void w.logWarn(`Invalid image URL: ${e}`);if(i===this._image?.src)return;const r=document.createElement("img");r.crossOrigin="anonymous",r.src=i,r.addEventListener("load",(()=>{this._image=r;const e=this._model,n=this.properties().childs();if(!t){const e=S(i);n.url.setValue(e),this._blobUrl=void 0}if(n.cssWidth.value()&&n.cssHeight.value())return void this._model.updateSource(this);const o=e.timeScale().width()/4,l=(0,s.ensureNotNull)(this.priceScale()).height()/4,a=r.naturalWidth,c=r.naturalHeight,u=Math.min(1,o/a),d=Math.min(1,l/c),p=Math.min(u,d),_=Math.round(p*a),P=Math.round(p*c);n.cssWidth.setValue(_),n.cssHeight.setValue(P),this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)})),r.addEventListener("error",(()=>{this.model().removeSource(this)}))}}
L._correctOriginDirections=[[-1,-1],[1,-1],[-1,1],[1,1],[0,0]],L._oppositePoints=[3,2,1,0,4],(0,m.runOnDrawingStateReady)((()=>{m.tool.subscribe(v)}))},241181:(e,t,i)=>{i.d(t,{asLineToolName:()=>Xi,ensureLineToolLoaded:()=>ji,getLineTool:()=>Zi,getLoadedLineTool:()=>Yi,isAsyncGenericLineToolName:()=>Hi,isAsyncStudyLineToolName:()=>Ui,isLineToolLoaded:()=>qi,loadLineTool:()=>Qi,loadMetaInfoForLinetoolIfRequired:()=>$i});var s=i(185842),r=i(729193),n=i(913947),o=i(726981),l=i(965947),a=i(23439),c=i(603550),h=i(576134);const u=new c.Property(!1);function d(e,t){return(0,s.ensureDefined)(e.child(`level${t}`))}class p extends h.InplaceTextUndoCommand{constructor(e,t,i,s,r){super(e,t,i,s),this._levelIndex=r}_textProperty(e){return d(e.properties(),this._levelIndex).childs().text}}class _ extends h.InplaceTextLineDataSource{constructor(){super(...arguments),this._inplaceEditLevelIndex=1}editableTextStyle(){return{...super.editableTextStyle(),forbidLineBreaks:!0,maxLength:50}}editableTextProperties(){const e=this.properties().childs();return{text:e.editableText,textColor:e.editableTextColor,wordWrap:u}}setInplaceEditLevelIndex(e){this._destroyEditableTextSubscriptions?.();const t=this.properties(),i=t.childs().editableText,r=t.childs().editableTextColor,n=d(t,e),o=(0,s.ensureDefined)(n).childs().text,l=(0,s.ensureDefined)(n).childs().color,a={};i.setValue(o.value()),r.setValue(l.value()),i.subscribe(a,(()=>o.setValue(i.value()))),o.subscribe(a,(()=>i.setValue(o.value()))),r.subscribe(a,(()=>l.setValue(r.value()))),l.subscribe(a,(()=>r.setValue(l.value()))),this._destroyEditableTextSubscriptions=()=>{i.unsubscribeAll(a),o.unsubscribeAll(a),r.unsubscribeAll(a),l.unsubscribeAll(a)},this._inplaceEditLevelIndex=e,this._editableText.setValue(i.value())}_changeEditableTextUndoCommand(e,t){return new p(this._model,this,e,t,this._inplaceEditLevelIndex)}static _configureProperties(e){super._configureProperties(e),e.addChild("editableText",new c.Property("")),e.addChild("editableTextColor",new c.Property("")),e.addExcludedKey("editableText",3),e.addExcludedKey("editableTextColor",3)}}const P=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class g extends _{constructor(e,t,s,r){super(e,t??g.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,308694)).then((e=>{this._paneView=new e.FibRetracementPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])}))}levelsCount(){return 24}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,{visible:s}=this.properties().childs()[i].childs();e.setProperty(s,!1,P,l.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){return this.properties().childs().fibLevelsBasedOnLogScale.value()&&!!this.priceScale()?.isLog()}template(){
const e=super.template();for(let t=1;t<=24;t++){const i=d(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibretracement",state:t,map:{range:[1,24],names:["coeff","color","visible","text"]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,934585))).FibDrawingsWith24LevelsDefinitionsViewModel}_applyTemplateImpl(e){for(let t=1;t<=24;t++){const i=d(this._properties,t),s=e[`level${t}`];i.childs().text.setValue(s.text??s[3]??"")}super._applyTemplateImpl(e)}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().trendline.childs().linewidth,e.childs().levelsStyle.childs().linewidth],i=[e.childs().trendline.childs().color];for(let t=1;t<=24;t++){const s=d(e,t);i.push(s.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}const m=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class f extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??f.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,712254)).then((({FibChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,r=(0,s.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(r,!1,m,l.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,s.assert)(!1,"unexpected method call")}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibchannel",state:t,map:{range:[1,24],names:["coeff","color","visible"]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,934585))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const r=(0,s.ensureDefined)(e.child("level"+i));t.push((0,s.ensureDefined)(r.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(t))}}var C=i(151713);class v extends C.LineToolFibWedgeBase{constructor(e,t,s,r){super(e,t??v.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,238622)).then((e=>{this._setPaneViews([new e.ProjectionLinePaneView(this,this._model)])}))}levelsCount(){return 1}name(){return"Projection"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolprojection",state:t,
map:{range:[1,1]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,218646))).ProjectionDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().trendline.childs().color]))}}const y=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class w extends _{constructor(e,t,s,r){super(e,t??w.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,302766)).then((({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}levelsCount(){return 24}pointsCount(){return 3}name(){return"Trend-Based Fib Extension"}migrateVersion(e,t){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,y,l.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){return this.properties().childs().fibLevelsBasedOnLogScale.value()&&Boolean(this.priceScale()?.isLog())}template(){const e=super.template();for(let t=1;t<=24;t++){const i=d(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetooltrendbasedfibextension",state:t,map:{names:["coeff","color","visible","linestyle","linewidth","text"],range:[0,24]},theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){for(let t=1;t<=24;t++){const i=d(this._properties,t),s=e[`level${t}`];i.childs().text.setValue(s.text??s[3]??"")}super._applyTemplateImpl(e)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,934585))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){const t=e.childs();super._configureProperties(e);const i=[t.trendline.childs().color];for(let t=1;t<=24;t++){const s=d(e,t);i.push(s.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new a.LineToolColorsProperty(i));const s=[t.trendline.childs().linewidth,t.levelsStyle.childs().linewidth];e.addChild("linesWidths",new a.LineToolWidthsProperty(s))}}var x=i(373391);const T=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class b extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??b.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,186246)).then((e=>{this._setPaneViews([new e.FibCirclesPaneView(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){const i=`level${t}`,r=(0,
s.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(r,!1,T,l.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,s.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibcircles",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,269361))).FibCirclesDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],r=[t.trendline.childs().color];for(let t=1;t<=11;t++)i.push((0,s.ensureDefined)(e.child("level"+t)?.child("linewidth"))),r.push((0,s.ensureDefined)(e.child("level"+t)?.child("color")));e.addChild("linesColors",new a.LineToolColorsProperty(r)),e.addChild("linesWidths",new a.LineToolWidthsProperty(i))}}var S=i(193867),L=i(816570),V=i(275925);class B extends L.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const s=this._source.points(),r=this._source.priceScale();if(0===s.length||null===r||r.isEmpty())return;const n=s[0];if(!isFinite(n.price))return;const o=this._source.ownerSource(),l=null!==o?o.firstValue():null;if(null===l)return;const a=(0,V.resetTransparency)(this._source.properties().linecolor.value());i.background=a,i.textColor=this.generateTextColor(a),i.coordinate=r.priceToCoordinate(n.price,l),e.text=r.formatPrice(n.price,l),e.visible=!0,e.selectedMarkColor=this._source.model().selection().isSelected(this._source)?a:void 0}}var D=i(914645),A=i(365737);class k extends A.LineDataSource{constructor(e,t,s,r){super(e,t??k.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._priceAxisView=new B(this),this._timeAxisView=new D.LineToolVertLineTimeAxisView(this),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,744702)).then((({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolcrossline",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}
_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,255377)).then((e=>e.CrossLineDefinitionsViewModel))}}var M=i(385955),N=i(657130),I=i(115676),F=i(687375),E=i(316746),R=i(168509);const O=new n.TranslatedString("mirror bars pattern",r.t(null,void 0,i(352451))),W=new n.TranslatedString("flip bars pattern",r.t(null,void 0,i(922245))),z=r.t(null,void 0,i(867769)),K=r.t(null,void 0,i(974934)),H={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},U={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class q extends A.LineDataSource{constructor(e,t=q.createProperties(e.backgroundTheme().spawnOwnership()),s,r){super(e,t,s,r),this._hasEditableCoordinates=new R.WatchedValue(!1),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const n=t.childs().mode.value();(0,M.isString)(n)&&t.childs().mode.setValue(parseInt(n)),t.childs().mirrored.subscribe(this,this._mirror),t.childs().flipped.subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,266990)).then((t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])}))}pattern(){return this._pattern}isSynchronizable(){return!1}async additionalActions(e){return{actions:[new N.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",options:{checked:this.properties().childs().mirrored.value(),checkable:!0,label:z,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),O,l.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}}),new N.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",options:{checked:this.properties().childs().flipped.value(),checkable:!0,label:K,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),W,l.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}})],placement:"CustomAction"}}pointsCount(){return 2}state(e){return{...super.state(e),pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:s=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=s}name(){return"Bars Pattern"}cloneData(e){this._pattern=(0,M.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===F.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[U[e.value()]]:i[H[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===F.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[H[e.value()]]:i[U[e.value()]]}addPoint(e,t,i){
const r=super.addPoint(e,t,!0);if(r){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),r=(0,s.ensureDefined)(e.nearestIndex(Math.min(t,i),I.PlotRowSearchMode.NearestRight)),n=(0,s.ensureDefined)(e.nearestIndex(Math.max(t,i),I.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(r,n),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(n-r),this._normalizePoints(),this.createServerPoints()),this._updatePointsCoordinatePricesDiff()}return r}setPoint(e,t,i,s){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,s){super.move(e,t,i,s),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolbarspattern",state:t,theme:e});return this._configureProperties(i),i}_preparePoint(e,t){const i=this._alignPointToRangeOfActualData(e),r=this._model.mainSeries(),n=(0,s.ensureNotNull)(r.bars().valueAt(i.index));this.properties().childs().mode.value()===F.LineToolBarsPatternMode.Bars?i.price=(0,s.ensure)(n[2]):i.price=(0,s.ensure)(n[4]);const o=(0,s.ensureNotNull)(this.priceScale()),l=(0,s.ensure)(this.ownerSource()?.firstValue()),a=.05*o.height(),c=o.priceToCoordinate(i.price,l)-a;return i.price=o.coordinateToPrice(c,l),super._preparePoint(i,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,525737))).BarsPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("mirrored",1),e.addExcludedKey("flipped",1)}_calculatePatternCoordinatePricesDiff(){return this._pattern.length>0?this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()])??null:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){if(2===this._points.length){const[{price:e},{price:t}]=this.points();return this._priceCoordinateDiff([e,t])??null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),r=[];for(let n=e;n<=t;n++)r.push((0,M.clone)((0,s.ensureNotNull)(i.valueAt(n))));return r}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let s=1;s<e.length;s++)t=Math.min(t,e[s][3]),i=Math.max(i,e[s][2]);if(t<i){
const s=(t+i)/2,r=e=>s-(e-s);for(let t=0;t<e.length;t++)e[t][2]=r(e[t][2]),e[t][3]=r(e[t][3]),e[t][1]=r(e[t][1]),e[t][4]=r(e[t][4])}this._switchPointsPrice(),this.updateAllViews((0,E.sourceChangeEvent)(this.id()))}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const s=e[i];e[i]=e[t-i-1],e[t-i-1]=s}this._switchPointsPrice(),this.updateAllViews((0,E.sourceChangeEvent)(this.id()))}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){const t=this.priceScale(),i=this.ownerSource()?.firstValue()??null;if(null!==i&&null!==t&&!t.isEmpty())return e.map((e=>t.priceToCoordinate(e,i)))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){if(this._points.length<2)return;const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===t||null===e||e.isEmpty())return;const i=this._calculatePatternCoordinatePricesDiff(),s=this._pricesToCoordinates([this.points()[0].price]);null!==i&&s&&(this._timePoint[1].price=this._points[1].price=e.coordinateToPrice(+(this._scale*i).toFixed(8)+s[0],t),this._updatePointsCoordinatePricesDiff())}}const G=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class Q extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Q.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=1,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,746846)).then((({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,G,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetooltrendbasedfibtime",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,274345))).TrendBasedFibTimeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],s=[t.trendline.childs().color];for(let e=1;e<=11;e++)i.push(t["level"+e].childs().linewidth),s.push(t["level"+e].childs().color);e.addChild("linesColors",new a.LineToolColorsProperty(s)),e.addChild("linesWidths",new a.LineToolWidthsProperty(i))}}const j=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)));class X extends A.LineDataSource{constructor(e,t,s,r){
super(e,t??X.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,311102)).then((({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}migrateVersion(e,t,i){if(1===e){const e=i.properties.childs(),t=i.properties,s=t.baselinecolor.value(),r=t.linecolor.value(),n=t.linewidth.value(),o=t.linestyle.value();e.level1.childs().color.setValue(s);for(let t=2;t<=11;t++)e["level"+t].childs().color.setValue(r);for(let t=1;t<=11;t++)e["level"+t].childs().linewidth.setValue(n),e["level"+t].childs().linestyle.setValue(o)}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,j,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibtimezone",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,952743))).FibTimezoneDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],s=[];for(let r=1;r<=11;r++){const n=e.childs()["level"+r].childs();t.push(n.linewidth),i.push(n.color),s.push(n.linestyle)}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t)),e.addChild("linesStyles",new a.LineToolCollectedProperty(s)),e.hasChild("baselinecolor")&&e.removeProperty("baselinecolor"),e.hasChild("linecolor")&&e.removeProperty("linecolor"),e.hasChild("linewidth")&&e.removeProperty("linewidth"),e.hasChild("linestyle")&&e.removeProperty("linestyle")}}var $=i(934),Y=i(645303),Z=i(694349),J=i(823291),ee=i(15113),te=i(786173);const ie=(0,J.getHexColorByName)("color-tv-blue-500"),se={linewidth:2,fontsize:12,fillLabelBackground:!0,fillBackground:!0,backgroundTransparency:60,showVolume:!0,intervalsVisibilities:{...ee.intervalsVisibilitiesDefaults},customText:{visible:!1,fontsize:12,bold:!1,italic:!1}},re=new Map([[Y.StdTheme.Light,{textcolor:(0,J.getHexColorByName)("color-black"),labelBackgroundColor:(0,J.getHexColorByName)("color-white"),linecolor:ie,backgroundColor:(0,V.generateColor)(ie,85),shadow:"rgba(0, 0, 0, 0.2)",customText:{color:ie}}],[Y.StdTheme.Dark,{textcolor:(0,J.getHexColorByName)("color-white"),labelBackgroundColor:(0,J.getHexColorByName)("color-cold-gray-800"),linecolor:ie,backgroundColor:(0,V.generateColor)(ie,85),shadow:"rgba(0, 0, 0, 0.4)",customText:{color:ie}}]]),ne=["customText.text"];function oe(e){const{showVolume:t=!0,...i}=e;return{...i,showVolume:t}}class le extends te.LineDataSourceProperty{constructor({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,state:i,...r}){super({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,templateKeys:[...e??[],...t??[],...ne],state:i?oe(i):void 0,...r});const n=i?.customText
;this._textProperty=new c.Property(n?.text??""),this.childs().customText?.addChild("text",this._textProperty),this.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(this.childs().customText?.child("color"))]))}template(){const e=super.template();return e.customText.text=this._textProperty.value(),e}}var ae=i(820650);const ce={...se,extendTop:!1,extendBottom:!1,showBarsRange:!0,showDateTimeRange:!0},he=re,ue=(0,S.extractThemedColors)((0,s.ensureDefined)(he.get(Y.StdTheme.Light)),(0,s.ensureDefined)(he.get(Y.StdTheme.Dark))),de=(0,S.extractAllPropertiesKeys)((0,s.ensureDefined)(he.get(Y.StdTheme.Light))),pe=(0,S.extractAllPropertiesKeys)(ce),_e=[...new Set([...de,...pe,...ae.commonLineToolPropertiesStateKeys,...ne])];class Pe extends le{static create(e,t){return new this({defaultName:"linetooldaterange",factoryDefaultsSupplier:()=>(0,Z.factoryDefaultsForCurrentTheme)(ce,he),nonThemedDefaultsKeys:pe,themedDefaultsKeys:de,allStateKeys:_e,themedColors:ue,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class ge extends A.LineDataSource{constructor(e,t,s,r){super(e,t??ge.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._volumeCalculator=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,409324)).then((e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,s.assert)(null===this._volumeCalculator),this._volumeCalculator=new $.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e,t){const i=Pe.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,434443))).GeneralDatePriceRangeDefinitionsViewModel}}const me={...se,extendLeft:!1,extendRight:!1,showPriceRange:!0,showPercentPriceRange:!0,showPipsPriceRange:!0},fe=re,Ce=(0,S.extractThemedColors)((0,s.ensureDefined)(fe.get(Y.StdTheme.Light)),(0,s.ensureDefined)(fe.get(Y.StdTheme.Dark))),ve=(0,S.extractAllPropertiesKeys)((0,s.ensureDefined)(fe.get(Y.StdTheme.Light))),ye=(0,S.extractAllPropertiesKeys)(me),we=[...new Set([...ve,...ye,...ae.commonLineToolPropertiesStateKeys,...ne])];class xe extends le{static create(e,t){return new this({defaultName:"linetoolpricerange",factoryDefaultsSupplier:()=>(0,Z.factoryDefaultsForCurrentTheme)(me,fe),nonThemedDefaultsKeys:ye,themedDefaultsKeys:ve,allStateKeys:we,themedColors:Ce,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class Te extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Te.createProperties(e.backgroundTheme().spawnOwnership()),s,r),
Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,754690)).then((e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Price Range"}template(){return this._properties.template()}static createProperties(e,t){const i=xe.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,434443))).GeneralDatePriceRangeDefinitionsViewModel}}const be=(0,J.getHexColorByName)("color-tv-blue-500"),Se={...se,drawBorder:!1,borderWidth:1,showBarsRange:!0,showDateTimeRange:!0,showPriceRange:!0,showPercentPriceRange:!0,showPipsPriceRange:!0},Le=new Map([[Y.StdTheme.Light,{...re.get(Y.StdTheme.Light),borderColor:be}],[Y.StdTheme.Dark,{...re.get(Y.StdTheme.Dark),borderColor:be}]]),Ve=(0,S.extractThemedColors)((0,s.ensureDefined)(Le.get(Y.StdTheme.Light)),(0,s.ensureDefined)(Le.get(Y.StdTheme.Dark))),Be=(0,S.extractAllPropertiesKeys)((0,s.ensureDefined)(Le.get(Y.StdTheme.Light))),De=(0,S.extractAllPropertiesKeys)(Se),Ae=[...new Set([...Be,...De,...ae.commonLineToolPropertiesStateKeys,...ne])];class ke extends le{static create(e,t){return new this({defaultName:"linetooldateandpricerange",factoryDefaultsSupplier:()=>(0,Z.factoryDefaultsForCurrentTheme)(Se,Le),nonThemedDefaultsKeys:De,themedDefaultsKeys:Be,allStateKeys:Ae,themedColors:Ve,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class Me extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Me.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._volumeCalculator=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,908676)).then((e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date and Price Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,s.assert)(null===this._volumeCalculator),this._volumeCalculator=new $.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e,t){const i=ke.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,434443))).GeneralDatePriceRangeDefinitionsViewModel}}var Ne=i(657415),Ie=i(193343),Fe=i(601263);class Ee extends c.Property{constructor(e){super(0),this._source=e}value(){const e=this._source.points();if(3!==e.length)return 0;const t=e[2].price-e[0].price,i=this._source.ownerSource()?.symbolSource().symbolInfo(),s=i?i.pricescale/i.minmov:100;return Math.round(t*s)/s}setValue(e){
const t=this._source.points();if(3===t.length){const i={...t[2],price:t[0].price+e},r=this._source.model();r.startChangingLinetool(this._source,(0,s.ensureNotNull)(this._source.ownerSource()),{...i},6),r.changeLinePoint({...i}),r.endChangingLinetool(!1),this._listeners.fire(this,"")}}}class Re extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Re.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=2,this._priceOffsetProperty=new Ee(this),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,this._pendingPriceOffset=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,224766)).then((({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})),Ie.alertsAvailable&&this._normalizedPointsChanged.subscribe(this,this._updateAlertCreationAvailable)}levelsCount(){return Fe.coeffs.length}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}snapTo45DegreesAvailable(){return!0}setLastPoint(e,t){this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[0]);const i=(0,M.clone)(e);return super.setLastPoint(e,t,!1),i}startMoving(e,t,i,s){super.startMoving(e,t,i,s),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t,i)}restoreExternalPoints(e,t){if(super.restoreExternalPoints(e,t),t.pricesChanged&&this._points.length===e.points.length)for(let t=0;t<e.points.length;t++)this._points[t].price=e.points[t].price}restorePoints(e,t,i){e[2]={...e[0],price:e[2].price},super.restorePoints(e,t,i),this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())}setPoint(e,t,i,r){if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const n=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),l=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),a=(0,s.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),c=(0,s.ensureNotNull)(this.priceScale()),h=(0,s.ensure)(this.ownerSource()?.firstValue()),u=this._model.mainSeries().interval();switch(e){case 0:super._setPoint(e,{...t,interval:u}),this._points[2].price=c.coordinateToPrice(l.y+a,h),this._points[2].index=t.index,this._points[2].interval=u;break;case 1:super._setPoint(e,{...t,interval:u});break;case 2:super._setPoint(e,{...t,interval:u}),this._points[0].price=c.coordinateToPrice(l.y-a,h),this._points[0].index=t.index,this._points[0].interval=u;break;case 3:this._points[1].price=c.coordinateToPrice(l.y-a,h),this._points[1].index=t.index,this._points[1].interval=u;break;case 4:{
const e=o.subtract(n),t=(l.x-n.x)/e.x,i=n.addScaled(e,t),s=l.y-i.y;this._points[2].price=c.coordinateToPrice(n.y+s,h);break}case 5:{const e=o.subtract(n),t=(l.x-n.x)/e.x,i=n.addScaled(e,t),s=l.y-i.y;this._points[0].price=c.coordinateToPrice(n.y+s,h),this._points[1].price=c.coordinateToPrice(o.y+s,h);break}case 6:this._points[2].price=t.price}const d=this.linkKey().value();d&&!r&&this._syncLineStyleChanges(d,{prices:this._points.map((e=>e.price))})}state(e){const t=super.state(e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const{prices:t,...i}=e;if(t&&this.isActualSymbol())for(let e=0;e<t.length;e++)this._points[e].price=this._timePoint[e].price=t[e];super.restoreExternalState(i)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return super.getPoint(e);const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),s=this.pointToScreenPoint(this._points[2]);if(!t||!i||!s)return null;switch(e){case 3:{const e=s.y-t.y,r=i.add(new Ne.Point(0,e));return this.screenPointToPoint(r)}case 4:{const e=s.y-t.y,r=i.add(new Ne.Point(0,e)),n=s.add(r).scaled(.5);return this.screenPointToPoint(n)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&1===this._points.length&&this.snapPoint45Degree(e,this.points()[0]),2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,s.ensureNotNull)(this._lastPoint))),this._addPointIntenal(e,t,i)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}hasStateForAlert(){return super.hasStateForAlert()&&this._isTimePointsValid()}priceOffsetProperty(){return this._priceOffsetProperty}static createProperties(e,t){const i=Fe.LineToolParallelChannelPropertiesImpl.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,826909))).ParallelChannelDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],s=i(t[0],t[1]),r=i(t[2],t[3]);let n,o,l,a;t[2].price<t[0].price?(o=r,n=s):(o=s,n=r);const c=this.properties().childs().extendLeft.value(),h=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(l=c,a=h):(l=h,a=c),[this._linePointsToAlertPlot(n,"Upper",l,a),this._linePointsToAlertPlot(o,"Lower",l,a)].filter((e=>null!==e))}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,
s.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),r=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=i.subtract(r),o=(t.x-r.x)/n.x,l=r.addScaled(n,o),a=t.y-l.y,c=r.add(new Ne.Point(0,a));return(0,s.ensureNotNull)(this.screenPointToPoint(c))}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1)}_isTimePointsValid(){return this._timePoint.every((e=>Number.isFinite(e.price)))}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,r=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&r){const n=i.y-t.y,o=r.add(new Ne.Point(0,n));e.push((0,s.ensureNotNull)(this.screenPointToPoint(o)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),r=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=i.subtract(r),o=(t.x-r.x)/n.x,l=r.addScaled(n,o),a=t.y-l.y,c=r.add(new Ne.Point(0,a));return(0,s.ensureNotNull)(this.screenPointToPoint(c))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,s.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return;const r=e+this._points[0].price,n=e+this._points[1].price,o=.5*(r+n)-e,l=.5*(r+n),a=t.priceToCoordinate(o,i),c=t.priceToCoordinate(l,i)-a,h=t.priceToCoordinate(this._points[0].price,i)+c,u=t.coordinateToPrice(h,i);this._points[2].price=u,this._timePoint[2].price=u,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(this._snapTo45DegreesApplicable(i))switch(e){case 0:case 1:this.snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,s.ensureNotNull)(this.getPoint(5-e));this.snapPoint45Degree(t,i)}}}class Oe extends c.Property{constructor(e){super(),this._lineSource=e}value(){return Math.round(100*this._lineSource.angle()*180/Math.PI)/100}setValue(e){const t=e%360*Math.PI/180,i=this._lineSource.model().timeScale().barSpacing(),r=Math.cos(t),n=-Math.sin(t),o=this._lineSource.distance();let l;if(1!==Math.abs(n)){const e=o*r,t=e%i,s=i-e%i,n=Math.abs((e-t)/r),a=Math.abs((e+s)/r);l=Math.max(n,a)}else l=o;const a=(0,s.ensureNotNull)(this._lineSource.pointToScreenPoint(this._lineSource.points()[0])).add(new Ne.Point(r*l,n*l)),c=(0,s.ensureNotNull)(this._lineSource.screenPointToPoint(a));this._lineSource.setPoint(1,c);const h=this._lineSource.model();h.updateSource(this._lineSource),this._lineSource.updateAllViews((0,E.sourceChangeEvent)(this._lineSource.id())),
h.updateSource(this._lineSource)}notifyChanged(){this._listeners.fire(this,"")}}class We extends h.InplaceTextLineDataSource{constructor(e,t,s,r){const n=t??We.createProperties(e.backgroundTheme().spawnOwnership());super(e,n,s,r),this._angle=0,this._distance=0,n.addChild("angle",new Oe(this)),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,955780)).then((({TrendAnglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}angle(){return this._angle}distance(){return this._distance}addPoint(e,t){const i=super.addPoint(e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){if(this.points().length<2)return[];const e=[this.points()[0]],t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),i=Math.cos(this._angle)*this._distance,r=-Math.sin(this._angle)*this._distance,n=t.add(new Ne.Point(i,r)),o=(0,s.ensureNotNull)(this.screenPointToPoint(n));return e.push(o),e}timeAxisPoints(){return this.axisPoints()}priceAxisPoints(){return this.axisPoints()}setPoint(e,t,i){super.setPoint(e,t,i),this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){this._angle=e.angle??0,this._distance=e.distance??0}state(e){const t=super.state(e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e.angle(),this._distance=e.distance()}canHasAlert(){return!0}editableTextProperties(){(0,s.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){t&&void 0===t.showPercentPriceRange&&(t.showPercentPriceRange=t.showPriceRange,t.showPipsPriceRange=t.showPriceRange);const i=new S.DefaultProperty({defaultName:"linetooltrendangle",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}_calculateAngle(){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));let t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[1])).subtract(e);const i=t.length();i>0?(t=t.normalized(),this._angle=Math.acos(t.x),t.y>0&&(this._angle=-this._angle),this._distance=i):this._angle=0;this.properties().childs().angle.notifyChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,438405)).then((e=>e.TrendAngleDefinitionsViewModel))}}var ze=i(520244),Ke=i(172137),He=i(757555);class Ue extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??Ue.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._delayedStudyViewsInitialization=!1,this._viewsModule=new Ke.AsyncResourceWrapper(Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,151572))),
this._viewsModule.callFunction((()=>{this._model.updateSource(this)}))}destroy(){this._viewsModule.destroy(),super.destroy()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){return!0}showPriceLabels(){return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new He.LineToolPriceAxisView(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.childs().linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor}}supportsTargetSignature(){return ze.shareDrawingsOnIndicators}isMultiPaneAvailable(){return this.supportsTargetSignature()}isMultiPaneEnabled(){return null!==this.targetSignature().value()}snapTo45DegreesAvailable(){return!0}static createProperties(e,t,i){return Ue._createPropertiesImpl("linetooltrendline",e,t,i)}_getPaneViews(e){if(null===this.targetSignature().value()&&!this._paneViews.has(e)&&(!e||e.hasDataSource(this))){const t=this._viewsModule.get();t&&this._paneViews.set(e,[new t.TrendLinePaneView(this,this._model,e??null,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}return super._getPaneViews(e)}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,906718))).TrendLineDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}_createSignatureSourcePaneViews(e){const t=this._viewsModule.get();if(null===t)return this._delayedStudyViewsInitialization||(this._delayedStudyViewsInitialization=!0,this._viewsModule.callFunction((()=>{this._signaturesPaneViews.clear(),this._updateSignaturesPaneViews()}))),[];return[new t.TrendLinePaneView(this,this._model,null,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),e)]}static _createPropertiesImpl(e,t,i,s){i&&void 0===i.showPercentPriceRange&&(i.showPercentPriceRange=i.showPriceRange,i.showPipsPriceRange=i.showPriceRange);const r=new S.DefaultProperty({theme:t,defaultName:e,state:i,useUserPreferences:s});return this._configureProperties(r),r}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}class qe extends Ue{constructor(e,t,i,s){super(e,t??qe.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e,t){const i=Ue._createPropertiesImpl("linetoolinfoline",e,t);return qe._configureProperties(i),i}}var Ge=i(593859)
;class Qe extends A.LineDataSource{constructor(e,t,s,r,n){super(e,t??Qe.createProperties(e.backgroundTheme().spawnOwnership(),null,s),r,n),this._textPaneView=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,673223)).then((({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t,i){const s=new S.DefaultProperty({defaultName:i,state:t});return this._configureProperties(s),s}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,203073)).then((e=>e.ArrowMarkDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1)}}Qe.version=2;class je extends Qe{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkleft",i,s)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:Ge.HorizontalAlign.Left,vertAlign:Ge.VerticalAlign.Middle,offsetX:22,offsetY:3}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkleft")}}class Xe extends Qe{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkup",i,s)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{horzAlign:Ge.HorizontalAlign.Center,vertAlign:Ge.VerticalAlign.Top,offsetX:0,offsetY:20}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkup")}}class $e extends Qe{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkright",i,s)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:Ge.HorizontalAlign.Right,vertAlign:Ge.VerticalAlign.Middle,offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkright")}}class Ye extends Qe{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkdown",i,s)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{horzAlign:Ge.HorizontalAlign.Center,vertAlign:Ge.VerticalAlign.Bottom,offsetX:0,offsetY:20}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkdown")}}const Ze=[4.5,9,11.25,18,22.5,36,45],Je=function(){const e=[],t=Ze.length-1;let i=1,s=0,r=0;for(;r<1e10;)r=Ze[s]*i,e.push(Math.round(r)),e.push(Math.ceil(-r)),s===t-1&&(i*=10),s=(s+1)%t;return e.sort(((e,t)=>e-t))}();class et extends A.LineDataSource{constructor(e,t,s,r){
super(e,t??et.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,694430)).then((({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return 7}vLevelsCount(){return 7}pointsCount(){return 2}name(){return"Gann Box"}getPoint(e){if(e<2)return super.getPoint(e);let t=null;switch(e){case 2:case 3:const i=this.points();if(i.length===this.pointsCount()){let s=i[0].index,r=i[1].price;3===e&&(s=i[1].index,r=i[0].price),t={index:s,price:r}}}return t}setPoint(e,t,i,s){if(i&&i.shift()){const i=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,i)}const r=this._model.mainSeries().interval();switch(e){case 2:this._points[0].index=t.index,this._points[0].interval=r,this._points[1].price=t.price;break;case 3:this._points[1].index=t.index,this._points[1].interval=r,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolgannsquare",state:t,map:{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]},theme:e});return this._configureProperties(i),i}_alignPriceOnPattern(e,t){const i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return;const s=Ze[0],r=Ze[Ze.length-1];let n=1;const o=Math.abs(i);for(;o<s*n||r*n<o;)o<s*n?n*=.1:r*n<o&&(n*=10);let l=r*n;for(let e=Ze.length-2;e>=0&&!(Ze[e]*n<o);--e)l=Ze[e]*n;e.price=t.price+(i>=0?l:-l)}_alignTimeOnPattern(e,t){const i=e.index-t.index;if(0===i)return;let s=Je.length-2;for(;s>=0&&!(Je[s]<i);--s);s+=i>0?1:0,e.index=t.index+Je[s]}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,86742))).GannSquareDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().color,e.childs().fans.childs().color];for(let i=1;i<=7;i++)t.push((0,s.ensureDefined)(e.child(`hlevel${i}`)?.child("color")));for(let i=1;i<=7;i++)t.push((0,s.ensureDefined)(e.child(`vlevel${i}`)?.child("color")));e.addChild("linesColors",new a.LineToolColorsProperty(t)),e.addExcludedKey("linesColors",3)}}var tt=i(855191),it=i(292865);class st extends A.LineDataSource{constructor(e,t,s,r){super(e,t??st.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._constructor="LineToolGannFixed",Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,890634)).then((({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints()
;return e.length<2||t.length<2?[]:[e[0],(0,s.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,r]=e,n=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,s.ensureNotNull)(this.pointToScreenPoint(r)),l=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),a=new Ne.Point(Math.cos(t),-Math.sin(t)),c=a.normalized(),h=c.x<0?-1:1,u=c.y<0?-1:1;return[n.addScaled(a,l),n.add(new Ne.Point(5*l*h,5*l*u))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let s=0;s<i;s++){const i=t.levels.childs()[s].childs();e.push({index:s,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let s=0;s<i;s++){const i=t.fanlines.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let s=0;s<i;s++){const i=t.arcs.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}static createProperties(e,t){const i=(0,it.createPropertiesObject)("linetoolgannfixed",e,t);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,742648)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],s=e.childs();{const e=s.levels.childCount();for(let r=0;r<e;r++){const e=s.levels.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.fanlines.childCount();for(let r=0;r<e;r++){const e=s.fanlines.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.arcs.childCount();for(let r=0;r<e;r++){const e=s.arcs.childs()[r].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,s=this.pointToScreenPoint(t),r=this.pointToScreenPoint(i);if(null===s||null===r)return null;let n=r.subtract(s);if(n.length()<=0)return null;n=n.normalized();let o=Math.acos(n.x);return n.y>0&&(o=-o),o}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this._normalizePoints(),this.restart()}}const rt=new n.TranslatedString("erase level line",r.t(null,void 0,i(266775)))
;class nt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??nt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,929640)).then((({GannFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 9}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){const i="level"+t,r=(0,s.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(r,!1,rt,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolgannfan",state:t,map:{range:[1,9]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,569106))).GannFanDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[];for(let r=1;r<=9;r++){const n=(0,s.ensureDefined)(e.child("level"+r));t.push((0,s.ensureDefined)(n.child("linewidth"))),i.push((0,s.ensureDefined)(n.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}var ot=i(456871);class lt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??lt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=1,this._hasEditableCoordinates=new R.WatchedValue(!1),this._priceAxisViews.push(this.createPriceAxisView(3)),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,605628)).then((e=>{this._setPaneViews([new e.DisjointChannelPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Disjoint Channel"}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,s){const r=.5*(this._points[1].price+this._points[2].price);if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){const e=this._points[1].price-r;this._points[2].price=this._points[1].price-2*e}else if(3===e){const e=t.price-this._points[2].price;this._points[0].price=this._points[1].price-e,this._points[0].index=t.index,this._points[0].interval=this._model.mainSeries().interval()}this._normalizePoints()}}getPoint(e){if(e<3)return super.getPoint(e);const t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}priceAxisPoints(){return this._axisPoints()}static createProperties(e,t){
const i=new S.DefaultProperty({defaultName:"linetooldisjointangle",state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const s=this._points[2];s.time=t.time,s.index=t.index;const r={price:s.price+(t.price-e.price),time:e.time,index:e.index},n=[];let o,l,a,c;s.index<=r.index?(n.push(s),n.push(r)):(n.push(r),n.push(s)),i[0].price>n[0].price?(o=i,l=n):n[0].price>i[0].price||n[1].price>i[1].price?(o=n,l=i):(o=i,l=n);const h=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(a=h,c=u):(a=u,c=h),[this._linePointsToAlertPlot(o,"Upper",a,c),this._linePointsToAlertPlot(l,"Lower",a,c)].filter(M.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,130472))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("labelTextColor"))]))}_axisPoints(){const e=this.points();return e.length>2&&e.push({index:e[0].index,price:e[1].price-e[0].price+e[2].price,time:e[0].time}),e}}class at extends A.LineDataSource{constructor(e,t,s,r){super(e,t??at.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this.version=1,this._hasEditableCoordinates=new R.WatchedValue(!1),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,968310)).then((e=>{this._setPaneViews([new e.FlatBottomPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Flat Bottom"}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,s){if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}const r=this._model.mainSeries().interval();if(2===e)this._points[1].index=t.index,this._points[1].interval=r;else if(3===e)return this._points[0].index=t.index,this._points[0].interval=r,this._points[2].price=t.price,void this._normalizePoints();super.setPoint(e,t)}getPoint(e){return e<3?super.getPoint(e):3===e?{index:this._points[0].index,price:this._points[2].price}:null}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolflatbottom",state:t,theme:e})
;return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const s=this._points[2];s.time=t.time,s.index=t.index;const r={price:s.price,time:e.time,index:e.index},n=[];let o,l,a,c;s.index<=r.index?(n.push(s),n.push(r)):(n.push(r),n.push(s)),i[0].price>n[0].price?(o=i,l=n):n[0].price>i[0].price||n[1].price>i[1].price?(o=n,l=i):(o=i,l=n);const h=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(a=h,c=u):(a=u,c=h),[this._linePointsToAlertPlot(o,"Upper",a,c),this._linePointsToAlertPlot(l,"Lower",h,c)].filter(M.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,130472))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("labelTextColor"))]))}}var ct=i(49833),ht=i(85818),ut=i(366783),dt=i(77357),pt=i(436492),_t=i(209539),Pt=i(171898);const gt={intervalsVisibilities:{...ee.intervalsVisibilitiesDefaults},color:Pt.colors.colorTvBlue500,size:72},mt={icon:61720,angle:.5*Math.PI},ft=(0,S.extractAllPropertiesKeys)(gt),Ct=(0,S.extractAllPropertiesKeys)(mt),vt=[...new Set([...Ct,...ft,...ae.commonLineToolPropertiesStateKeys])];class yt extends te.LineDataSourceProperty{constructor(e){super(e),this.addChild("backgroundsColors",new a.LineToolColorsProperty([this.childs().color]))}static create(e,t,i){return new this({defaultName:"linetoolicon",factoryDefaultsSupplier:()=>(0,pt.default)(gt),nonThemedDefaultsKeys:ft,themedDefaultsKeys:[],state:(0,_t.default)({},mt,{icon:i},t??{}),allStateKeys:vt,theme:e})}}const wt=(0,dt.getLogger)("Chart.LineToolIcon");class xt extends ut.LineToolSvgIconBase{constructor(e,t,i,s){super(e,t??xt.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this.version=1,this._loadViews()}name(){return"Icon"}template(){return this._properties.template()}static createProperties(e,t){const i=yt.create(e,t,ct.iconTool.value());return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,863544)).then((e=>e.IconsDefinitionsViewModel))}async _loadViews(){const[{getSvgContentForCharCode:e,getSvgRenderer:t},{IconPaneView:s}]=await Promise.all([i.e(18304).then(i.bind(i,733444)),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,523806))]);if(!this._isDestroyed){const i=this._properties.childs().icon.value();this._svgContent=e(i),this._onIconChanged.fire();const r=t(ht.svgRenderer,i)
;null===r&&wt.logWarn(`Couldn't create svg renderer for icon ${i}`),this._setPaneViews([new s(this,this._model,r)])}}}const Tt={intervalsVisibilities:{...ee.intervalsVisibilitiesDefaults},size:72},bt={sticker:"bitcoin",angle:.5*Math.PI},St=(0,S.extractAllPropertiesKeys)(Tt),Lt=(0,S.extractAllPropertiesKeys)(bt),Vt=[...new Set([...Lt,...St,...ae.commonLineToolPropertiesStateKeys])];class Bt extends te.LineDataSourceProperty{constructor(e){super(e)}static create(e,t,i){return new this({defaultName:"linetoolsticker",factoryDefaultsSupplier:()=>(0,pt.default)(Tt),nonThemedDefaultsKeys:St,themedDefaultsKeys:[],allStateKeys:Vt,state:(0,_t.default)({},bt,{sticker:i},t??{}),theme:e})}}const Dt=(0,dt.getLogger)("Chart.LineToolSticker");class At extends ut.LineToolSvgIconBase{constructor(e,t,i,s){super(e,t??At.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this.version=1,this._loadViews()}name(){return"Sticker"}static createProperties(e,t){const i=Bt.create(e,t,ct.stickerTool.value());return At._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,662053))).LineDataSourceDefinitionsViewModel}async _loadViews(){const[{getSvgContentForSticker:e,getSvgRenderer:t},{StickerPaneView:s}]=await Promise.all([i.e(79902).then(i.bind(i,838014)),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,185326))]);if(!this._isDestroyed){const i=this._properties.childs().sticker.value();this._svgContent=e(i),this._onIconChanged.fire();const r=t(ht.svgRenderer,i);null===r&&Dt.logWarn(`Couldn't create svg renderer for sticker ${i}`),this._setPaneViews([new s(this,this._model,r)])}}}var kt=i(717086);class Mt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Mt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._hasEditableCoordinates=new R.WatchedValue(!1),this._distance=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,321169)).then((({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=this._points,t=(0,s.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(e[1])),r=(0,s.ensureNotNull)(this.pointToScreenPoint(e[2]));this._distance=(0,kt.distanceToLine)(t,i,r).distance}}setPoint(e,t,i,r){if(super.setPoint(e,t,i),0===e||1===e){const e=this._points,t=(0,s.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(e[1])).subtract(t),r=new Ne.Point(i.y,-i.x).normalized().scaled((0,s.ensureNotNull)(this._distance)),n=t.add(r),o=(0,s.ensureNotNull)(this.screenPointToPoint(n)),l=this._model.mainSeries().interval();this._points[2]={...o,interval:l}}}endChanging(e,t,i){return this._distance=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,709262))).GeneralFiguresDefinitionsViewModelBase}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolrotatedrectangle",state:t,theme:e});return this._configureProperties(i),i}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}class Nt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Nt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,650484)).then((t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolheadandshoulders",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,957553)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textcolor]))}}class It extends A.LineDataSource{constructor(e,t,i,s){super(e,t??It.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetool5pointspattern",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,957553)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}_loadPaneViews(e){Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,305858)).then((t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}class Ft extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Ft.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,785520)).then((t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolthreedrivers",state:t,theme:e});return this._configureProperties(i),i}
_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,438932)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new a.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}class Et extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Et.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,423944)).then((t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])}))}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolabcd",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,438932)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}var Rt=i(515338);class Ot extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Ot.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._hasEditableCoordinates=new R.WatchedValue(!1),this._finished=!1,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,998754)).then((t=>{this._setPaneViews([new t.PathPaneView(this,e)])}))}pointsCount(){return-1}name(){return"Path"}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}addPoint(e,t,i,r){if(this._finished)return!0;const n=(0,s.ensureNotNull)(this.priceScale()),o=this._model.timeScale().indexToCoordinate(e.index),l=e.price,a=(0,s.ensure)(this.ownerSource()?.firstValue()),c=n.priceToCoordinate(l,a);if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),s=e.price,l=n.priceToCoordinate(s,a),h=new Ne.Point(o,c).subtract(new Ne.Point(i,l)).length();if(!t?.isApiEvent()&&h<(0,Rt.interactionTolerance)().minDistanceBetweenPoints&&!r)return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolpath",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,562971)).then((e=>e.PathDefinitionsViewModel))}static _configureProperties(e){
super._configureProperties(e),e.addChild("linesWidths",new a.LineToolWidthsProperty([(0,s.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().lineColor]))}}var Wt=i(426527);class zt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??zt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._predictionPaneView=null;const n=this._model.mainSeries();n.properties().childs().interval.subscribe(this,(()=>{this.setStatus(Wt.AlertStatus.Waiting)})),n.dataEvents().dataUpdated().subscribe(this,this.recalculateStateByData),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,179430)).then((t=>{this._predictionPaneView=new t.PredictionPaneView(this,e),this._setPaneViews([this._predictionPaneView])}))}destroy(){const e=this._model.mainSeries();e.properties().childs().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){return super.dataAndViewsReady()&&Boolean(this._predictionPaneView&&this._predictionPaneView.iconsReady())}cloneable(){return!1}isSynchronizable(){return!1}status(){return this._properties.childs().status.value()}setStatus(e){return this._properties.childs().status.setValue(e)}pointsCount(){return 2}name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.recalculateStateByData()}recalculateStateByData(){if(this.isSourceHidden())return;if(this._points.length<2)return;if(this._model.mainSeries().bars().isEmpty())return;const e=this._points[1];if(this.status())return void(e.index>this._model.timeScale().baseIndex()&&this.setStatus(Wt.AlertStatus.Waiting));const t=this._model.mainSeries().bars().valueAt(e.index);if(null===t)return;const i=this.direction();if(i===Wt.Direction.Up&&(0,s.ensure)(t[2])>=e.price)this.setStatus(Wt.AlertStatus.Success);else if(i===Wt.Direction.Down&&(0,s.ensure)(t[3])<=e.price)this.setStatus(Wt.AlertStatus.Success);else{const t=(0,s.ensureNotNull)(this._model.mainSeries().bars().lastIndex());e.index!==t&&this.setStatus(Wt.AlertStatus.Failure)}}addPoint(e,t,i){const s=super.addPoint(e,t,i);return s&&this.recalculateStateByData(),s}endChanging(e,t){const i=super.endChanging(e,t);return this.setStatus(Wt.AlertStatus.Waiting),this.recalculateStateByData(),i}onData(e){super.onData(e),this.recalculateStateByData()}endMoving(e,t,i){const s=super.endMoving(e,t,i);return this.setStatus(Wt.AlertStatus.Waiting),this.recalculateStateByData(),s}direction(){if(this._points.length<2)return Wt.Direction.Up;const e=this._points[0];return this._points[1].price>e.price?Wt.Direction.Up:Wt.Direction.Down}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolprediction",state:t,theme:e});return this._configureProperties(i),i}_ignoreSourceEvent(e){return super._ignoreSourceEvent(e)&&e.sourceId!==this._model.mainSeries().id()}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,980241)).then((e=>e.PredictionDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("status")||e.addChild("status",new c.Property(Wt.AlertStatus.Waiting))}}class Kt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Kt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,25028)).then((e=>{this._setPaneViews([new e.PriceLabelPaneView(this,this._model)])}))}pointsCount(){return 1}name(){return"Price Label"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolpricelabel",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,641244))).PriceLabelDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}}class Ht extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Ht.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,727228)).then((({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}))}pointsCount(){return 2}name(){return"Arrow Marker"}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolarrowmarker",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,338048)).then((e=>e.ArrowMarkerDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1)}}var Ut=i(581724);class qt extends c.Property{constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,(()=>this.fireChanged())),e.pointChanged().subscribe(this,(()=>this.fireChanged()))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.fireChanged(),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var Gt=i(356187);class Qt extends Gt.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}class jt extends Ut.LineToolWithRelativePriceCoordinate{constructor(e,t=jt.createProperties(e.backgroundTheme().spawnOwnership()),s,r){super(e,t,s,r),
this._textColorProperty=new c.Property("transparent"),this._setTextColorByTheme=e=>{this._textColorProperty.setValue(e?(0,J.getHexColorByName)("color-cold-gray-200"):(0,J.getHexColorByName)("color-cold-gray-900"))},e.dark().subscribe(this._setTextColorByTheme,{callWithLast:!0}),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,668066)).then((t=>{this._setPaneViews([new t.SignpostPaneView(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}destroy(){this._model.dark().unsubscribe(this._setTextColorByTheme),super.destroy()}pointsCount(){return 1}name(){return"Signpost"}customEvent(){return{index:()=>this.points()[0]?.index??null,position:()=>this.properties().childs().position.value()}}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}shouldBeRemovedOnDeselect(){const e=this._properties.childs();if(e.showImage.value())return!1;return""===e.text.value().trim()}editableTextProperties(){return{text:this.properties().childs().text,textColor:this._textColorProperty}}activateEditingOnCreation(){return!0}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolsignpost",state:t,theme:e});return this._configureProperties(i),i}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new qt(this)),t.addChild("bar",new Qt(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,669411)).then((e=>e.SignpostDefinitionsViewModel))}static _configureProperties(e){A.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.hasChild("position")||e.addChild("position",new c.Property(50)),e.addExcludedKey("text",1),e.addExcludedKey("position",1),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().plateColor]))}}jt.supportPhantomMode=!0;var Xt=i(598237);class $t extends Xt.LineToolBrushBase{constructor(e,t,i,s){super(e,t??$t.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolbrush",state:t,theme:e});return this._configureProperties(i),i}_loadPaneViews(e){
Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,596010)).then((t=>{this._setPaneViews([new t.BrushPaneView(this,e)])}))}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,747118)).then((e=>e.BrushDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground)),e.hasChild("linestyle")&&e.removeProperty("linestyle"),e.hasChild("linesStyles")&&e.removeProperty("linesStyles")}}var Yt=i(984131);class Zt extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Zt.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._hasEditableCoordinates=new R.WatchedValue(!1),this.version=2,this._dist=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,332918)).then((({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,kt.distanceToLine)(e,t,i).distance;const r=t.subtract(e),n=new Ne.Point(-r.y,r.x),o=e.add(t).scaled(.5);i.subtract(o).dotProduct(n)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Arc"}setPoint(e,t){const i={...t},r=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),o=this._model.mainSeries().interval();switch(e){case 0:{const e=(0,s.ensureNotNull)(this._dist),t=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),r=n.subtract(t),l=t.add(n).scaled(.5);let a=new Ne.Point(-r.y,r.x);a=a.normalized();const c=l.add(a.scaled(e));this._points[0]={...i,interval:o},this._points[2]={...(0,s.ensureNotNull)(this.screenPointToPoint(c)),interval:o};break}case 1:{const e=(0,s.ensureNotNull)(this._dist),t=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),n=t.subtract(r),l=r.add(t).scaled(.5),a=new Ne.Point(-n.y,n.x).normalized(),c=l.add(a.scaled(e));this._points[1]={...i,interval:o},this._points[2]={...(0,s.ensureNotNull)(this.screenPointToPoint(c)),interval:o};break}case 2:{let e=(0,s.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,kt.distanceToLine)(r,n,e).distance,l=n.subtract(r),a=r.add(n).scaled(.5),c=new Ne.Point(-l.y,l.x).normalized(),h=a.add(c.scaled(t)),u=a.add(c.scaled(-t)),d=l.length(),p=l.x/d,_=l.y/d;let P=Math.acos(p);_<0&&(P=-P);let g=(0,Yt.translationMatrix)(-a.x,-a.y);e=(0,Yt.transformPoint)(g,e);let m=(0,Yt.transformPoint)(g,h);g=(0,Yt.rotationMatrix)(-P),e=(0,Yt.transformPoint)(g,e),m=(0,Yt.transformPoint)(g,m),g=(0,Yt.scalingMatrix)(1,d/(2*t)),e=(0,Yt.transformPoint)(g,e),m=(0,Yt.transformPoint)(g,m)
;const f=e.y*m.y>=0?new Ne.Point(h.x,h.y):new Ne.Point(u.x,u.y);this._points[2]={...(0,s.ensureNotNull)(this.screenPointToPoint(f)),interval:o};break}}this._normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:t,index:this._points[1].index,interval:e})}if(1===e&&2===this._timePoint.length){const e={price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(e)}}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolarc",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,709262))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}var Jt=i(18107),ei=i(536002),ti=i(331210);class ii extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t||ii.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._barOffset=0,this._dragStartLeftEdgeIndex=NaN,this._timeScale=e.timeScale(),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,347794)).then((e=>{this._paneView=new e.CalloutPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])}))}pointsCount(){return 2}name(){return"Callout"}getBarOffset(){return this._barOffset}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}activateEditingOnCreation(){return!0}shouldBeRemovedOnDeselect(){const e=this._properties.childs().text.value().trim();return this._points.length===this.pointsCount()&&""===e}addPoint(e){const t=super.addPoint(e);return t&&this._calculateBarOffset(),t}setLastPoint(e){const t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:const i=this.properties().childs();if(!i.wordWrapWidth)return;const s=this._points,r=this._dragStartLeftEdgeIndex,n=Math.round((t.index-r)/2),o=this._model.mainSeries().interval();if(isFinite(r)&&isFinite(n)){s[1]={index:r+n,price:s[1].price,interval:o},this._calculateBarOffset(),this._normalizePoints();const e=this._timeScale.indexToCoordinate(r+2*n)-this._timeScale.indexToCoordinate(r)-8-2;if(!isFinite(e))return;i.wordWrapWidth.setValue(Math.max(100,e));break}s[1]={...t,interval:o},this._calculateBarOffset(),this._normalizePoints()}}setPoints(e){super.setPoints(e);const t=this.properties().childs();if(!t.wordWrapWidth)return
;const i=this._dragStartLeftEdgeIndex,s=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this._normalizePoints(),isFinite(i)&&isFinite(s)){const e=this._timeScale.indexToCoordinate(i+2*s)-this._timeScale.indexToCoordinate(i)-8-2;if(!isFinite(e))return;t.wordWrapWidth.setValue(Math.max(100,e))}}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){const t=super.state(e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this.calculatePoint2()}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&this.calculatePoint2()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}calculatePoint2(){if(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this))return;if(this._points.length<2)return;const[e,t]=this.points();this._points[1]={price:t.price,index:e.index+this._barOffset,interval:this._model.mainSeries().interval()}}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolcallout",state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){this.properties().childs().text.setValue(e.text),super._applyTemplateImpl(e)}_correctPoints(e,t){if(e.length<this.pointsCount()||null===this._currentMovingPoint||void 0===this._currentMovingPoint.logical||null===this._startMovingPoint||void 0===this._startMovingPoint.logical)return!1;const i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,s=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,r=e[1];return r.index=r.index+i,r.price+=s,e[1]=r,!0}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(1===this._points.length&&this._points.push(this._points[0]),this._dragStartLeftEdgeIndex=this.points()[1].index)}_normalizePoint(e,t){return 0===t?super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t):super._normalizePoint(e,t)}_createDataSourceBackgroundColorWV(){const e=(0,ei.generateColorCached)(),{backgroundColor:t,transparency:i}=this.properties().childs();return(0,Jt.combine)(((t,i)=>e(t,i)),(0,ti.convertPropertyToWatchedValue)(t).ownership(),(0,ti.convertPropertyToWatchedValue)(i).ownership()).ownership()}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,728838))).CalloutDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}}var si=i(183651);class ri extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??ri.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._priceAxisView=new B(this),
Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,850022)).then((({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0,interval:this._model.mainSeries().interval()})}clearData(){const e=this._points;super.clearData(),this._points=e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor}}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolhorzline",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,763901)).then((e=>e.HorizontalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}class ni extends A.LineDataSource{constructor(e,t,s,r){super(e,t??ni.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._priceAxisView=new B(this),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,321172)).then((({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolhorzray",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price
},i=this._linePointsToAlertPlot([e,t],null,!1,!0);return null!==i?[i]:[]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,111957))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}var oi=i(575199),li=i(686287);const ai={intervalsVisibilities:{...ee.intervalsVisibilitiesDefaults},color:Pt.colors.colorGrapesPurple500,fillBackground:!0,backgroundColor:Pt.colors.colorGrapesPurple500Alpha20,linewidth:li.DEFAULT_LINE_TOOL_LINE_WIDTH,transparency:50,horzLabelsAlign:Ge.HorizontalAlign.Center,vertLabelsAlign:Ge.VerticalAlign.Middle,textColor:Pt.colors.colorGrapesPurple500,fontSize:14,bold:!1,italic:!1,extendLeft:!1,extendRight:!1,middleLine:{showLine:!1,lineWidth:1,lineColor:Pt.colors.colorGrapesPurple500,lineStyle:oi.LineStyle.Dashed},linestyle:oi.LineStyle.Solid},ci=new Map([[Y.StdTheme.Light,{}],[Y.StdTheme.Dark,{}]]),hi=(0,S.extractThemedColors)((0,s.ensureDefined)(ci.get(Y.StdTheme.Light)),(0,s.ensureDefined)(ci.get(Y.StdTheme.Dark))),ui=(0,S.extractAllPropertiesKeys)((0,s.ensureDefined)(ci.get(Y.StdTheme.Light))),di=(0,S.extractAllPropertiesKeys)(ai),pi=[...new Set([...ui,...di,...ae.commonLineToolPropertiesStateKeys,"text"])],_i=[...new Set([...ui,...di,"text"])];class Pi extends te.LineDataSourceProperty{constructor(e){super(e),this.hasChild("text")||this.addProperty("text","")}static create(e,t,i){return new this({defaultName:"linetoolrectangle",factoryDefaultsSupplier:()=>(0,Z.factoryDefaultsForCurrentTheme)(ai,ci),nonThemedDefaultsKeys:di,themedDefaultsKeys:ui,allStateKeys:pi,themedColors:hi,templateKeys:_i,replaceThemedColorsOnThemeChange:!0,state:t,theme:e,useUserPreferences:i})}}const gi=Ie.alertsAvailable;class mi extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??mi.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,391369)).then((({RectanglePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Rectangle"}setPoint(e,t,i){if(e<2)return void super.setPoint(e,t,i);if(this._snapTo45DegreesApplicable(i)){const i=this._getSnapTo45DegreesAnchorPoint(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this._normalizePoints();this.snapPoint45Degree(t,i)}const s=this._model.mainSeries().interval();switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index,this._points[0].interval=s;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index,this._points[1].interval=s;break;case 4:this._points[0].index=t.index,
this._points[0].interval=s;break;case 5:this._points[1].index=t.index,this._points[1].interval=s;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this._normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){return this._properties.template()}snapTo45DegreesAvailable(){return!0}snapPoint45Degree(e,t,i){const r=this._priceScale,n=this.ownerSource();if(null===r||null===n)return;const o=n.firstValue();if(null===o)return;const l=this._model.timeScale(),a=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),c=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),h=a.x-c.x,u=a.y-c.y,d=h<0?-1:1,p=u<0?-1:1,_=Math.max(Math.abs(h),Math.abs(u)),P=Math.round(l.coordinateToIndex(c.x+_*d)),g=Math.abs(l.indexToCoordinate(P)-c.x),m=r.coordinateToPrice(c.y+g*p,o);e.index=P,e.price=m}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}canHasAlert(){return gi}stateForAlert(){const e=super.stateForAlert(),t=this._model.timeScale(),i=this._points;return null===e||t.isEmpty()||i.length<this.pointsCount()?null:{...e,shapeType:"rectangle",rect:{baseTime:(0,s.ensureNotNull)(t.indexToTimePoint(0)),coordinates:[{offset:i[0].index,price:i[0].price},{offset:i[1].index,price:i[1].price}]}}}static createProperties(e,t,i){const s=Pi.create(e,t,i);return this._configureProperties(s),s}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,345333)).then((e=>e.RectangleDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,Jt.combine)(((e,t)=>e?t:null),(0,ti.convertPropertyToWatchedValue)(e).ownership(),(0,ti.convertPropertyToWatchedValue)(t).ownership()).ownership()}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const r=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),n=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let a=r.x-n.x;if(0===a)return;const c=o.x<l.x?1:-1,h=o.y<l.y?1:-1;switch(a*=c,e){case 4:{const e=l.y-h*a/2,t=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(l.x,e)));this._points[1].price=t.price;const i=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(o.x+c*a,o.y+h*a/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=o.y-h*a/2,t=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(o.x,e)));this._points[0].price=t.price;const i=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(l.x+c*a,l.y+h*a/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const r=this._priceScale,n=this.ownerSource();if(null===r||null===n)return
;const o=this._model.timeScale(),l=n.firstValue();if(null===l)return;const a=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),c=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),h=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),u=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),d=a.y-c.y,p=d<0?-1:1,_=h.x<u.x?1:-1,P=h.y<u.y?1:-1;switch(e){case 6:{const e=Math.floor(u.x-_*d/2),t=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(e,u.y))),i=Math.abs(this._points[1].index-t.index),n=_*P*p*Math.ceil(i/2);if(0===n)return;this._points[1].index=this._points[1].index-n;const a=p*Math.abs(o.indexToCoordinate(this._points[1].index)-u.x);this._points[0].price=r.coordinateToPrice(h.y+a,l),this._points[0].index=this._points[0].index+n;break}case 7:{const e=Math.floor(h.x-_*d/2),t=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(e,h.y))),i=Math.abs(this._points[0].index-t.index),n=_*P*p*Math.ceil(i/2);if(0===n)return;this._points[0].index=this._points[0].index-n;const a=p*Math.abs(o.indexToCoordinate(this._points[0].index)-h.x);this._points[1].price=r.coordinateToPrice(u.y+a,l),this._points[1].index=this._points[1].index+n;break}}}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("text",1),e.addExcludedKey("linesColors",1),e.addExcludedKey("textsColors",1)}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],s=t[1];let r=0,n=0;switch(e){case 0:r=i.price,n=i.index;break;case 1:r=s.price,n=s.index;break;case 2:r=s.price,n=i.index;break;case 3:r=i.price,n=s.index;break;case 4:r=(s.price+i.price)/2,n=i.index;break;case 5:r=(s.price+i.price)/2,n=s.index;break;case 6:r=i.price,n=(s.index+i.index)/2;break;case 7:r=s.price,n=(s.index+i.index)/2}return{index:n,price:r}}_getSnapTo45DegreesAnchorPoint(e){if(e>=4)return this._getAnchorPointForIndex(e);const t=this.points(),i=t[0],s=t[1];let r=0,n=0;switch(e){case 0:r=s.price,n=s.index;break;case 1:r=i.price,n=i.index;break;case 2:r=i.price,n=s.index;break;case 3:r=s.price,n=i.index}return{index:n,price:r}}}class fi extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??fi.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,580160)).then((({CirclePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Circle"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}snapTo45DegreesAvailable(){return!0}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolcircle",state:t,theme:e});return this._configureProperties(i),
i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,909225))).EllipseCircleDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,Jt.combine)(((e,t)=>e?t:null),(0,ti.convertPropertyToWatchedValue)(e).ownership(),(0,ti.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new a.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("linesColors",3),e.addExcludedKey("linesWidths",3),e.addExcludedKey("backgroundsColors",3),e.addExcludedKey("textsColors",3),e.addExcludedKey("text",1)}}class Ci extends h.InplaceTextLineDataSource{constructor(e,t,s,r){super(e,t??Ci.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._hasEditableCoordinates=new R.WatchedValue(!1),this._radius2=0,this._fakePoint=null,this.version=2,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,473425)).then((({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}snapTo45DegreesAvailable(){return!0}startChanging(e,t){super.startChanging(e,t),this._radius2=(0,kt.distanceToLine)(this._screenPoint(0),this._screenPoint(1),this._screenPoint(2)).distance}addPoint(e,t,i){let s;const r=1===this._points.length?this._preparePoint(e,t):e;return s=this._addPointIntenal(r,t,i),2===this._points.length&&this._snapTo45DegreesApplicable(t)&&(s=this._addPointIntenal(this._calcPoint2(),t,i)),s&&(this._fakePoint=null),s}setPoint(e,t,i,r){const n={...t},o=this._model.mainSeries().interval();switch(e){case 0:case 1:const t=this._snapTo45DegreesApplicable(i);t&&this.snapPoint45Degree(n,this._points[0===e?1:0]),this._setPoint(e,{...n,interval:o}),this._setPoint(2,{...this._calcPoint2(void 0,void 0,t?void 0:this._radius2),interval:o}),t&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0===e?0:1],this._points[0===e?1:0],this._points[2]);break;case 2:case 3:const r=this._screenPoint(0),l=this._screenPoint(1),a=(0,s.ensureNotNull)(this.pointToScreenPoint(n)),c=(0,kt.distanceToLine)(r,l,a).distance,h=l.subtract(r),u=r.add(l).scaled(.5),d=new Ne.Point(-h.y,h.x).normalized(),p=u.add(d.scaled(c));this._setPoint(2,{...(0,s.ensureNotNull)(this.screenPointToPoint(p)),interval:o})}this._normalizePoints()}points(){const e=super.points();return 2===e.length&&this._fakePoint&&e.push(this._fakePoint),e}pointsCount(){return 3}
name(){return"Ellipse"}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=this._points[0].price,i=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:i,index:this._points[0].index,interval:e},this._points[1]={price:i,index:this._points[1].index,interval:e},this._points.push({price:t,index:this._points[0].index,interval:e})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(i)}}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolellipse",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,909225))).EllipseCircleDefinitionsViewModel}_preparePoint(e,t){const i=this._preparePointInternal(e,this._points[0],t),s=this._points[1]??this._lastPoint;return this._snapTo45DegreesApplicable(t)&&this._points[0].index===s.index&&this._fixVerticalDiameterPoints(s,this._points[0],i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,Jt.combine)(((e,t)=>e?t:null),(0,ti.convertPropertyToWatchedValue)(e).ownership(),(0,ti.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("text",1)}_preparePointInternal(e,t,i){const r={...e};return this._fakePoint=null,this._snapTo45DegreesApplicable(i)&&1===this._points.length&&(this.snapPoint45Degree(r,t),this._fakePoint=this._calcPoint2((0,s.ensureNotNull)(this.pointToScreenPoint(t)),(0,s.ensureNotNull)(this.pointToScreenPoint(r)))),r}_fixVerticalDiameterPoints(e,t,i){const r=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),n=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),o=this._model.timeScale(),l=o.indexToCoordinate(e.index),a=o.indexToCoordinate(i.index);let c=2*Math.abs(l-a);c*=t.price>e.price?1:-1,e.price=(0,s.ensureNotNull)(this.screenPointToPoint(new Ne.Point(r.x,n.y+c))).price}_calcPoint2(e,t,i){e=e??this._screenPoint(0),t=t??this._screenPoint(1);const r=Math.atan2(t.y-e.y,t.x-e.x)+Math.PI/2;i=i??t.subtract(e).length()/2;const n=e.add(t).scaled(.5).add(new Ne.Point(Math.cos(r)*i,Math.sin(r)*i));return(0,
s.ensureNotNull)(this.screenPointToPoint(n))}_screenPoint(e){return(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[e]))}}class vi extends A.LineDataSource{constructor(e,t,s,r){super(e,t??vi.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,315610)).then((e=>{this._setPaneViews([new e.TimeCyclesPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t){const i=(0,pt.default)(t),s=this._points[0],r=this._points[1];s.price=i.price,r.price=i.price,this._points[e]={...i,interval:this._model.mainSeries().interval()},this._normalizePoints()}addPoint(e,t,i){const s=super.addPoint(e,t,!0);if(s){const e=this._points[0];this._points[1].price=e.price,i||(this._normalizePoints(),this.createServerPoints())}return s}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetooltimecycles",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,315534))).TimeCyclesPatternDefinitionsViewModel}}class yi extends A.LineDataSource{constructor(e,t,s,r){super(e,t??yi.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,642797)).then((e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolsineline",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,763309))).CyclicAndSineLinesPatternDefinitionsViewModel}}class wi{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=i??[]}setBars(e){this._bars=e}clone(e){return new wi(e,this._segmentIndex,(0,M.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const s=this._segmentIndex?t.index+1:t.index,r=Math.sign(i.index-t.index);for(let e=s;e!==i.index;e+=r)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,s.ensureNotNull)(this._source.ownerSource()).base();let r=Math.random();const n=e*(1-2*r)*t;r=Math.random();const o=e*(1+(.5-r)*t),l=n-o/2,a=l+o;return{o:(l+Math.random()*o)/i,h:a/i,l:l/i,c:(l+Math.random()*o)/i}}}class xi extends A.LineDataSource{constructor(e,t,s,r){const n=t??xi.createProperties(e.backgroundTheme().spawnOwnership());if(super(e,n,s,r),this._segments=[],
this._finished=!1,this._segmentsPixelsWhileMoving=null,!s){const e=Math.round(this._calculateATR());n.childs().averageHL.setValue(e)}n.childs().averageHL.subscribe(this,this._regenerate),n.childs().variance.subscribe(this,this._regenerate),this._currentAverageHL=n.childs().averageHL.value(),this._currentVariance=n.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,994776)).then((t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])}))}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new wi(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._finished)return!0;if(this._points.length>0){const i=this._points[this._points.length-1];if(!t?.isApiEvent()&&i.index===e.index){this._lastPoint=null,this._normalizePoints(),this.createServerPoints();for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const s=super.addPoint(e,t,i);return this._points.length>1&&this.generateBars(this._points.length-2),s}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}setPoint(e,t,i,s){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],s=t.index-i.index;this._segments[e-1].setSize(Math.abs(s))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){return{...super.state(e),segments:this._segments.map((e=>({bars:[...e.bars()]})))}}restoreData(e){e.segments&&(this._segments=e.segments.map(((e,t)=>new wi(this,t,e.bars)))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){this._segments=e._segments.map((e=>e.clone(this)))}startMoving(e,t,i,s){super.startMoving(e,t,i,s),this._preparePixelSegments()}move(e,t,i,s){super.move(e,t,i,s),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolghostfeed",state:t,theme:e});return this._configureProperties(i),i}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,289732))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR());this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach((e=>e.generate())),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each(((e,i)=>{const s=i[2],r=i[3];return null!=s&&null!=r&&t.push(s-r),!1}));let i=0===t.length?0:t.reduce(((e,t)=>e+t),0)/t.length;return i*=e.base(),i}_preparePixelSegments(){const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===e||null===t||e.isEmpty()||!e.isLog())return;const i=this.points();this._segmentsPixelsWhileMoving=this._segments.map(((s,r)=>{const n=i[r].price,o=i[r+1].price,l=e.priceToCoordinate(n,t),a=(e.priceToCoordinate(o,t)-l)/(s.bars().length-1);return{bars:s.bars().map(((i,s)=>{const r=l+s*a,n=e.coordinateToPrice(r,t);return{open:e.priceToCoordinate(n+i.o,t)-r,high:e.priceToCoordinate(n+i.h,t)-r,low:e.priceToCoordinate(n+i.l,t)-r,close:e.priceToCoordinate(n+i.c,t)-r}}))}}))}_restoreSegmentsFromPixels(){const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===e||null===t||null===this._segmentsPixelsWhileMoving)return;const i=this.points();this._segmentsPixelsWhileMoving.forEach(((s,r)=>{const n=this._segments[r],o=i[r].price,l=i[r+1].price,a=e.priceToCoordinate(o,t),c=(e.priceToCoordinate(l,t)-a)/(s.bars.length-1),h=n.bars().map(((i,r)=>{const n=s.bars[r],o=a+r*c,l=e.coordinateToPrice(o,t);return{...i,o:e.coordinateToPrice(n.open+o,t)-l,h:e.coordinateToPrice(n.high+o,t)-l,l:e.coordinateToPrice(n.low+o,t)-l,c:e.coordinateToPrice(n.close+o,t)-l}}));n.setBars(h)}))}}class Ti extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Ti.createProperties(e.backgroundTheme().spawnOwnership()),s,r),this._controlPoint=null,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,728082)).then((t=>{this._setPaneViews([new t.BezierQuadroPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Curve"}normalizedPointsForCreating(){const e=super.normalizedPointsForCreating();return[e[0],e[e.length-1]]}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const s=super.addPoint(e,t,i);if(s){const e=this._calculateControlPoint();this._points.push({...e,interval:this._model.mainSeries().interval()}),this._controlPoint=null,i||(this._normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return s}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e,t){const i=new S.DefaultProperty({
defaultName:"linetoolbezierquadro",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,6658)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoint(){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),r=e.add(t).scaled(.5).add(i);return(0,s.ensureNotNull)(this.screenPointToPoint(r))}}class bi extends Ue{constructor(e,t,i,s){super(e,t??bi.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Arrow"}static createProperties(e,t){const i=Ue._createPropertiesImpl("linetoolarrow",e,t);return bi._configureProperties(i),i}}class Si extends Ue{constructor(e,t,i,s){super(e,t??Si.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Ray"}static createProperties(e,t){const i=Ue._createPropertiesImpl("linetoolray",e,t);return Si._configureProperties(i),i}}class Li extends Ue{constructor(e,t,i,s){super(e,t??Li.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Extended Line"}static createProperties(e,t){const i=Ue._createPropertiesImpl("linetoolextended",e,t);return Li._configureProperties(i),i}}class Vi extends ot.LineToolPitchfork{constructor(e,t,i,s){super(e,t??Vi.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Modified Schiff Pitchfork"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolschiffpitchfork",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}}class Bi extends ot.LineToolPitchfork{constructor(e,t,i,s){super(e,t??Bi.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Schiff Pitchfork"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolschiffpitchfork2",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}}class Di extends A.LineDataSource{constructor(e,t,s,r){super(e,t??Di.createProperties(e.backgroundTheme().spawnOwnership()),s,r),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,942797)).then((({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new Ne.Point(0,0)),this._setPaneViews([t])}))}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e,t){t&&void 0===t.flagColor&&(t.flagColor="#318757");const i=new S.DefaultProperty({defaultName:"linetoolflagmark",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,967906)).then((e=>e.FlagMarkDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),
e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().flagColor])),e.addExcludedKey("backgroundsColors",3)}}Di.version=2;class Ai extends It{constructor(e,t,i,s){super(e,t??Ai.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Cypher Pattern"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolcypherpattern",state:t,theme:e});return this._configureProperties(i),i}_loadPaneViews(e){Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,226399)).then((t=>{this._setPaneViews([new t.CypherPaneView(this,e)])}))}}var ki=i(90315),Mi=i(730023),Ni=i(403288);class Ii extends Xt.LineToolBrushBase{constructor(e,t,i,s){super(e,t??Ii.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e,t){const i=new S.DefaultProperty({defaultName:"linetoolhighlighter",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,121467)).then((e=>e.HighlighterDefinitionsViewModel))}_loadPaneViews(e){Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,285510)).then((t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("widths",new a.LineToolWidthsProperty([e.childs().width])),e.addExcludedKey("widths",3)}}var Fi=i(830213),Ei=i(196806);const Ri=new Map;Ri.set("LineToolFibRetracement",g),Ri.set("LineToolFibChannel",f),Ri.set("LineToolProjection",v),Ri.set("LineToolTrendBasedFibExtension",w),Ri.set("LineToolElliott",x.LineToolElliott),Ri.set("LineToolFibCircles",b),Ri.set("LineToolCrossLine",k),Ri.set("LineToolBarsPattern",q),Ri.set("LineToolTrendBasedFibTime",Q),Ri.set("LineToolFibTimeZone",X),Ri.set("LineToolDateRange",ge),Ri.set("LineToolPriceRange",Te),Ri.set("LineToolDateAndPriceRange",Me),Ri.set("LineToolParallelChannel",Re),Ri.set("LineToolTrendAngle",We),Ri.set("LineToolTrendLine",Ue),Ri.set("LineToolInfoLine",qe),Ri.set("LineToolArrowMark",Qe),Ri.set("LineToolGannSquare",et),Ri.set("LineToolGannComplex",tt.LineToolGannComplex),Ri.set("LineToolGannFixed",st),Ri.set("LineToolGannFan",nt),Ri.set("LineToolPitchfork",ot.LineToolPitchfork),Ri.set("LineToolDisjointAngle",lt),Ri.set("LineToolFlatBottom",at),Ri.set("LineToolIcon",xt),Ri.set("LineToolSticker",At),Ri.set("LineToolRotatedRectangle",Mt),Ri.set("LineToolHeadAndShoulders",Nt),Ri.set("LineTool5PointsPattern",It),Ri.set("LineToolThreeDrivers",Ft),Ri.set("LineToolABCD",Et),Ri.set("LineToolPath",Ot),Ri.set("LineToolPrediction",zt),Ri.set("LineToolPriceLabel",Kt),Ri.set("LineToolArrowMarker",Ht),Ri.set("LineToolSignpost",jt),Ri.set("LineToolBrush",$t),Ri.set("LineToolArc",Zt),Ri.set("LineToolCallout",ii),Ri.set("LineToolText",si.LineToolText),
Ri.set("LineToolHorzLine",ri),Ri.set("LineToolHorzRay",ni),Ri.set("LineToolRectangle",mi),Ri.set("LineToolCircle",fi),Ri.set("LineToolEllipse",Ci),Ri.set("LineToolTimeCycles",vi),Ri.set("LineToolSineLine",yi),Ri.set("LineToolGhostFeed",xi),Ri.set("LineToolBezierQuadro",Ti),Ri.set("LineToolArrow",bi),Ri.set("LineToolRay",Si),Ri.set("LineToolExtended",Li),Ri.set("LineToolSchiffPitchfork",Vi),Ri.set("LineToolSchiffPitchfork2",Bi),Ri.set("LineToolTextAbsolute",si.LineToolTextAbsolute),Ri.set("LineToolArrowMarkLeft",je),Ri.set("LineToolArrowMarkRight",$e),Ri.set("LineToolArrowMarkUp",Xe),Ri.set("LineToolArrowMarkDown",Ye),Ri.set("LineToolFlagMark",Di),Ri.set("LineToolCypherPattern",Ai),Ri.set("LineToolElliottImpulse",x.LineToolElliottImpulse),Ri.set("LineToolElliottTriangle",x.LineToolElliottTriangle),Ri.set("LineToolElliottTripleCombo",x.LineToolElliottTripleCombo),Ri.set("LineToolElliottCorrection",x.LineToolElliottCorrection),Ri.set("LineToolElliottDoubleCombo",x.LineToolElliottDoubleCombo),Ri.set("LineToolPosition",ki.LineToolPosition),Ri.set("LineToolOrder",Mi.LineToolOrder),Ri.set("LineToolHighlighter",Ii),Ri.set("LineToolImage",Ni.LineToolImage);const Oi=async e=>{const[t,s]=await Promise.all([Promise.all([i.e(63631),i.e(40696),i.e(88874),i.e(25648)]).then(i.bind(i,426873)),Promise.all([i.e(63631),i.e(40696),i.e(88874),i.e(25648)]).then(i.bind(i,955379))]),r=t.LineToolRiskRewardLong,n=s.LineToolRiskRewardShort;return Ri.set("LineToolRiskRewardLong",r),Ri.set("LineToolRiskRewardShort",n),"LineToolRiskRewardLong"===e?r:n
},Wi=new Map([["LineToolPriceNote",async()=>(await Promise.all([i.e(11149),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(2428),i.e(24013)]).then(i.bind(i,812363))).LineToolPriceNote],["LineToolTextNote",async()=>(await Promise.all([i.e(87115),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(2428),i.e(5917)]).then(i.bind(i,487101))).LineToolTextNote],["LineToolNote",async()=>(await Promise.all([i.e(89756),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(98557)]).then(i.bind(i,266784))).LineToolNote],["LineToolFibSpiral",async()=>(await Promise.all([i.e(94667),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(57234)]).then(i.bind(i,633138))).LineToolFibSpiral],["LineToolCircleLines",async()=>(await Promise.all([i.e(95233),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(81758)]).then(i.bind(i,776636))).LineToolCyclicLines],["LineToolNoteAbsolute",async()=>(await Promise.all([i.e(89756),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(98557)]).then(i.bind(i,266784))).LineToolNoteAbsolute],["LineToolTable",async()=>(await Promise.all([i.e(92953),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(9343),i.e(39843)]).then(i.bind(i,905900))).LineToolTable],["LineToolFibSpeedResistanceArcs",async()=>(await Promise.all([i.e(67115),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(17929),i.e(26070)]).then(i.bind(i,2931))).LineToolFibSpeedResistanceArcs],["LineToolVertLine",async()=>(await Promise.all([i.e(3443),i.e(40696),i.e(88874),i.e(1826)]).then(i.bind(i,562513))).LineToolVertLine],["LineToolPitchfan",async()=>(await Promise.all([i.e(22481),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(72465)]).then(i.bind(i,193322))).LineToolPitchfan],["LineToolFibSpeedResistanceFan",async()=>(await Promise.all([i.e(22641),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(21596)]).then(i.bind(i,739836))).LineToolFibSpeedResistanceFan],["LineToolFibWedge",async()=>(await Promise.all([i.e(61253),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(17929),i.e(46739)]).then(i.bind(i,170795))).LineToolFibWedge],["LineToolEmoji",async()=>(await Promise.all([i.e(83899),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(42871),i.e(88697)]).then(i.bind(i,933661))).LineToolEmoji],["LineToolTrianglePattern",async()=>(await Promise.all([i.e(40696),i.e(88874),i.e(71632)]).then(i.bind(i,80132))).LineToolTrianglePattern],["LineToolTriangle",async()=>(await Promise.all([i.e(40696),i.e(88874),i.e(21977)]).then(i.bind(i,551038))).LineToolTriangle],["LineToolPolyline",async()=>(await Promise.all([i.e(40696),i.e(88874),i.e(15734)]).then(i.bind(i,834924))).LineToolPolyline],["LineToolBalloon",async()=>(await Promise.all([i.e(22773),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(49974)]).then(i.bind(i,737989))).LineToolBalloon],["LineToolComment",async()=>(await Promise.all([i.e(22773),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(49974),i.e(66040)]).then(i.bind(i,255998))).LineToolComment],["LineToolBezierCubic",async()=>(await Promise.all([i.e(99843),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(993)]).then(i.bind(i,867222))).LineToolBezierCubic],["LineToolInsidePitchfork",async()=>(await i.e(70688).then(i.bind(i,683823))).LineToolInsidePitchfork],["LineToolRiskRewardLong",()=>Oi("LineToolRiskRewardLong")],["LineToolRiskRewardShort",()=>Oi("LineToolRiskRewardShort")]])
;Wi.set("LineToolTweet",(async()=>(await Promise.all([i.e(4193),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(53113),i.e(20247)]).then(i.bind(i,855411))).LineToolTweet)),Wi.set("LineToolIdea",(async()=>(await Promise.all([i.e(44574),i.e(45448),i.e(57350),i.e(93787),i.e(37305),i.e(40696),i.e(88874),i.e(85262),i.e(95025),i.e(53113),i.e(84436)]).then(i.bind(i,661714))).LineToolIdea));const zi=new Map,Ki=new Map([["LineToolAnchoredVWAP",async()=>(await Promise.all([i.e(70438),i.e(26492),i.e(42628)]).then(i.bind(i,975711))).LineToolAnchoredVWAP],["LineToolRegressionTrend",async()=>(await i.e(1100).then(i.bind(i,534423))).LineToolRegressionTrend],["LineToolVbPFixed",async()=>(await Promise.all([i.e(70438),i.e(70059)]).then(i.bind(i,504465))).LineToolVbPFixed],["LineToolFixedRangeVolumeProfile",async()=>(await Promise.all([i.e(70438),i.e(70059)]).then(i.bind(i,299631))).LineToolFixedRangeVolumeProfile]]);function Hi(e){return Wi.has(e)||Ki.has(e)||Ri.has(e)}function Ui(e){return Ki.has(e)}function qi(e){return!Hi(e)||Ri.has(e)||zi.has(e)}Ki.set("LineToolAnchoredVolumeProfile",(async()=>(await Promise.all([i.e(70438),i.e(70059)]).then(i.bind(i,881233))).LineToolAnchoredVolumeProfile));let Gi=0;async function Qi(e){if(qi(e))return Yi(e);const t=Ui(e);Gi+=1;const i=(0,s.ensureDefined)((t?Ki:Wi).get(e)),r=await i();return Gi-=1,t?(zi.set(e,(0,s.ensureDefined)(r)),Yi(e)):(Ri.set(e,(0,s.ensureDefined)(r)),Yi(e))}async function ji(e){await $i(e),Hi(e)&&!qi(e)&&await Qi(e)}function Xi(e){return e}async function $i(e){(function(e){return!!["LineToolRiskRewardLong","LineToolRiskRewardShort"].includes(e)||(0,Ei.isStudyLineTool)(e)||Ui(e)})(e)&&await(0,Fi.studyMetaInfoRepository)().findAllJavaStudies()}function Yi(e){return Ui(e)?(0,s.ensureDefined)(zi.get(e),`Study line tool ${e}`):(0,s.ensureDefined)(Ri.get(e),`Line tool ${e}`)}async function Zi(e){return qi(e)?Yi(e):Qi(e)}},489203:(e,t,i)=>{i.d(t,{LineToolTradingPriceAxisView:()=>r});var s=i(757555);class r extends s.LineToolPriceAxisView{_formatPrice(e,t){return this._source.formatter().format(e)}}},489793:(e,t,i)=>{i.d(t,{lineToolsStudyIds:()=>s});const s={LineToolAnchoredVWAP:"AnchoredVWAP@tv-basicstudies",LineToolRegressionTrend:"RegressionTrend@tv-basicstudies",LineToolFixedRangeVolumeProfile:"VbPFixed@tv-basicstudies",LineToolVbPFixed:"VbPFixed@tv-volumebyprice"};{const e={LineToolAnchoredVolumeProfile:"VbPAnchored@tv-basicstudies"};for(const[t,i]of Object.entries(e))s[t]=i}},730023:(e,t,i)=>{var s=i(495539).LineToolTrading,r=i(489203).LineToolTradingPriceAxisView,n=i(786265),o=i(365737).LineDataSource,l=i(193867).DefaultProperty;const{isFeaturesetEnabled:a}=i(266150),c=i(316746).sourceChangeEvent;var h=i(65345).sortSourcesPreOrdered.LineToolOrder;function u(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setDirection(e){
return this._direction=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setActive(e){return this._active=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw(c(this._line.id()))}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(u(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(u(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}getLineColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){
return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return n.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}
setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){return n.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return n.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){
return n.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return n.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return n.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return n.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return n.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}
setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw(c(this._line.id()))}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw(c(this._line.id()))}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onMoving(e,t){return t?this.isFunction(t)&&(this._onMovingData=e,this._onMovingCallback=t):this.isFunction(e)&&(this._onMovingCallback=e),this}callOnMoving(){this.isFunction(this._onMovingCallback)&&this._onMovingCallback.call(this,this._onMovingData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends s{constructor(e,t){var s=t||p.createProperties(e.backgroundTheme().spawnOwnership());super(e,s),this._adapter=new d(this),this.setSelectionEnabled(!0),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,846874)).then((({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}move(e,t,i,s){var r=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.move(e,t,i,s),r&&this._adapter.callOnMoving()}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new r(this,t),this._priceAxisView}paneViews(){
return TradingView.printing&&!a("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}formatter(){return this._formatter}static createProperties(e,t){var i=new l({defaultName:"linetoolorder",state:t,useUserPreferences:!1,theme:e});return this._configureProperties(i),i}}t.LineToolOrder=p},456871:(e,t,i)=>{i.d(t,{LineToolPitchfork:()=>P});var s=i(185842),r=i(913947),n=i(729193),o=i(657130),l=i(726981),a=i(965947),c=i(365737),h=i(23439),u=i(316746),d=i(608719);const p=new r.TranslatedString("erase level line",n.t(null,void 0,i(266775))),_=new r.TranslatedString("change {title} style",n.t(null,void 0,i(667236)));class P extends c.LineDataSource{constructor(e,t,i,s){super(e,t??P.createProperties(e.backgroundTheme().spawnOwnership()),i,s),this._properties.childs().style.subscribe(this,this._recreatePaneView),this._recreatePaneView()}pointsCount(){return 3}name(){return"Pitchfork"}levelsCount(){return 8}async additionalActions(e){const t=[],s=[{title:n.t(null,void 0,i(125536)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToOriginal"},{title:n.t(null,void 0,i(658026)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff"},{title:n.t(null,void 0,i(937648)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToInside"},{title:n.t(null,void 0,i(385138)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToSchiff"}];for(let i=0;i<4;i++){const n=new o.Action({actionId:s[i].actionId,options:{checked:this.properties().childs().style.value()===i,checkable:!0,label:s[i].title,onExecute:()=>{e.setProperty(this.properties().childs().style,i,_.format({title:new r.TranslatedString(this.name(),this.translatedType())}),a.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}});t.push(n)}return{actions:[t[0],t[3],t[1],t[2]],placement:"CustomAction"}}processErase(e,t){const i="level"+t,r=(0,s.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(r,!1,p,a.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new l.LevelsProperty({defaultName:"linetoolpitchfork",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}async _recreatePaneView(){Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,800253)).then((e=>{let t=[];const i=this._properties.childs().style.value()
;i===d.LineToolPitchforkStyle.Original?t=[new e.PitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff?t=[new e.SchiffPitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff2?t=[new e.SchiffPitchfork2LinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Inside&&(t=[new e.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(t)}))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,402517))).PitchForkDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().median.childs().linewidth],i=[e.childs().median.childs().color];for(let r=0;r<=8;r++){const n=(0,s.ensureDefined)(e.child("level"+r));t.push((0,s.ensureDefined)(n.child("linewidth"))),i.push((0,s.ensureDefined)(n.child("color")))}e.addChild("linesColors",new h.LineToolColorsProperty(i)),e.addChild("linesWidths",new h.LineToolWidthsProperty(t))}}},90315:(e,t,i)=>{var s=i(495539).LineToolTrading,r=i(365737).LineDataSource,n=i(489203).LineToolTradingPriceAxisView,o=i(786265),l=i(193867).DefaultProperty;const{isFeaturesetEnabled:a}=i(266150),c=i(316746).sourceChangeEvent;var h=i(65345).sortSourcesPreOrdered.LineToolPosition;function u(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw(c(this._line.id()))}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(u(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(u(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(u(e)),this}getReverseTooltip(){return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getExtendLeft(){var e=this._line.properties().extendLeft.value()
;return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){
return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){
return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw(c(this._line.id()))}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw(c(this._line.id()))}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw(c(this._line.id()))),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){
return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends s{constructor(e,t){var s=t||p.createProperties(e.backgroundTheme().spawnOwnership());super(e,s),this._adapter=new d(this),Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.t.bind(i,37570,19)).then((({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}adapter(){return this._adapter}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}createPriceAxisView(e){return this._priceAxisView=new n(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!a("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?r.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?r.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e,t){var i=new l({defaultName:"linetoolposition",state:t,useUserPreferences:!1,theme:e});return this._configureProperties(i),i}}t.LineToolPosition=p},520244:(e,t,i)=>{i.d(t,{shareDrawingsOnIndicators:()=>s});const s=(0,i(788312).isFeatureEnabled)("share_drawings_on_indicators")},366783:(e,t,i)=>{i.d(t,{LineToolSvgIconBase:()=>h});var s=i(185842),r=i(657415),n=i(168509),o=i(980002),l=i(875500),a=i(365737);function c(e,t,i){return i>=4&&(i-=4),Math.atan2(e.y-t.y,e.x-t.x)+Math.PI/4+Math.PI/2*i+Math.PI/2}class h extends a.LineDataSource{constructor(e,t,i,s){super(e,t,i,s),this._onIconChanged=new l.Delegate,this._svgContent=null,this._iconUrl=null,this._hasEditableCoordinates=new n.WatchedValue(!1),this._changePointData=null,this._loadViews()}pointsCount(){return 1}getAdditionalPadding(){return 4*Math.max(1,this.properties().childs().size.value()/72)}getChangePointForSync(e){return null}startChanging(e,t){const i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=this.properties().childs(),l=n.size.value();let a;if(t)a=(0,s.ensureNotNull)(this.pointToScreenPoint(t));else{const e=l/2+this.getAdditionalPadding();a=(0,r.point)(i.y+e,i.y+e),t=(0,s.ensureNotNull)(this.screenPointToPoint(a,!0))}const h=i.subtract(a).length();this._changePointData={centerPoint:i,
initialLength:h,initialSize:l,originalAngle:n.angle.value(),startChangeAngle:c(a,i,e??0),alwaysChangeAngle:(0,o.lastMouseOrTouchEventInfo)().isTouch,startPoint:t},super.startChanging(e,t)}setPoint(e,t,i){const{centerPoint:r,initialLength:n,initialSize:o,startChangeAngle:l,originalAngle:a,alwaysChangeAngle:h,startPoint:u}=(0,s.ensureNotNull)(this._changePointData),d=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),p=this.properties().childs();if(e>=4||h){const t=c(d,r,e);p.angle.setValue(a+(t-l))}if(e<4){const e=r.subtract(d).length(),i=Math.max(20,o*(e/n));if(p.size.setValue(i),!h){const{index:e,price:i}=this._points[0],{index:s,price:r}=u,{index:n,price:o}=t;r<=i!=o<=i||s<=e!=n<=e?p.angle.setValue(a+Math.PI):p.angle.setValue(a)}}}getSourceIcon(){if(this._iconUrl)return{type:"url",href:this._iconUrl};const e=this.svgContent();return null===e?null:{type:"svgContent",content:e}}onSourceIconChanged(){return this._onIconChanged}svgContent(){return this._svgContent}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("angle",1)}}},183651:(e,t,i)=>{i.d(t,{LineToolText:()=>p,LineToolTextAbsolute:()=>_});var s=i(185842),r=i(657415),n=i(18107),o=i(331210),l=i(168509),a=i(603550),c=i(193867),h=i(23439),u=i(316746),d=i(576134);class p extends d.InplaceTextLineDataSource{constructor(e,t,s,r){const n=t??p.createProperties(e.backgroundTheme().spawnOwnership());super(e,n,s,r),this._hasEditableCoordinates=new l.WatchedValue(!1),this._recalculatePointsOnCenter=!1,Promise.all([i.e(53228),i.e(40696),i.e(88874),i.e(82426),i.e(17929),i.e(14472),i.e(42871),i.e(81495)]).then(i.bind(i,844826)).then((({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._paneView=new t(this,e,void 0,void 0,void 0,void 0,void 0,i,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])})),n.childs().anchored.subscribe(this,this._onAnchoredChange.bind(this))}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){if(1!==e)return void super.setPoint(e,t,i);const r=this.properties().childs();let n;if(r.wordWrapWidth.value()){const e=this.model().timeScale();n=this.isFixed()?(0,s.ensureDefined)(this.fixedPoint()).x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-n-~~(r.fontsize.value()/6);if(!isFinite(i))return;r.wordWrapWidth.setValue(Math.max(100,i))}}pointsCount(){return 1}name(){return"Text"}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}activateEditingOnCreation(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.barSpacing=this._model.timeScale().barSpacing()),t}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}isFixed(){return this._properties.childs().anchored.value()}anchorable(){return!0}
static createProperties(e,t){const i=new c.DefaultProperty({defaultName:this._defaultName(),state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(87193),i.e(85262),i.e(95025),i.e(9343),i.e(59328)]).then(i.bind(i,992803)).then((e=>e.TextDefinitionsViewModel))}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,n.combine)(((e,t)=>e?t:null),(0,o.convertPropertyToWatchedValue)(e).ownership(),(0,o.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _defaultName(){return"linetooltext"}static _anchoredDefaultValue(){return!1}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new a.Property("")),e.hasChild("anchored")||e.addChild("anchored",new a.Property(this._anchoredDefaultValue())),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("text",1),e.addExcludedKey("anchored",1),e.addExcludedKey("linesColors",3),e.addExcludedKey("textsColors",3)}_recalculateCenterPosition(e,t){const i=this.isFixed()?(0,s.ensureDefined)(this.fixedPoint()):(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=new r.Point(i.x-e/2,i.y-t/2),o=(0,s.ensureNotNull)(this.screenPointToPoint(n));this.setPoints([{...o,interval:this._model.mainSeries().interval()}]),this._normalizePoints(),this.createServerPoints(),this.updateAllViewsAndRedraw((0,u.sourceChangeEvent)(this.id()))}}class _ extends p{constructor(e,t,i,s){super(e,t??_.createProperties(e.backgroundTheme().spawnOwnership()),i,s)}name(){return"Anchored Text"}static _defaultName(){return"linetooltextabsolute"}static _anchoredDefaultValue(){return!0}}},495539:(e,t,i)=>{const s=i(365737).LineDataSource,r=i(23589).alignToStep,n=(i(310834).customFormatters,i(70346).createSeriesFormatter);class o extends s{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this._createFormatter(e.mainSeries().symbolInfo()),this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return o.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){super.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){super.endMoving.apply(this,arguments),this._cursorMoved=!1}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}_correctPoints(e,t){this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1
;for(var i=1/this.priceScale().mainSource().base(),s=0;s<e.length;s++){var n=e[s];this._cursorMoved&&(n.price=this._currentMovingPoint.logical.price),n.price=r(n.price,i),e[s]=n}}_createFormatter(e){this._formatter=n(e,"default",!1,!0)}}o.POINTS_COUNT=1,e.exports.LineToolTrading=o},914645:(e,t,i)=>{i.d(t,{LineToolVertLineTimeAxisView:()=>n});var s=i(275925),r=i(947417);class n extends r.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return(0,s.resetTransparency)(this._source.properties().linecolor.value())}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}},65345:(e,t,i)=>{i.d(t,{sortSources:()=>r,sortSourcesPreOrdered:()=>s});const s={KeyFactsToday:10000001,LatestUpdates:10000002,BarMarks:10000003,TimeScaleMarks:10000004,ChartEventsSource:10000005,Dividends:10000006,Splits:10000007,Earnings:10000008,RollDates:10000009,FutureContractExpiration:10000010,LineToolOrder:10000011,LineToolPosition:10000012,LineToolExecution:10000013,AlertLabelInactive:10000014,AlertLabel:10000015};function r(e,t){if(0===e.length)return[];if(!t)return[...e].sort(((e,t)=>e.zorder()-t.zorder()));if(!(t.model().mainPane()===t))return[...e].sort(((e,t)=>e.zorder()-t.zorder()));const i=t.model().panes(),s=i.indexOf(t),r=e=>i.findIndex((t=>t.hasDataSource(e)));return e.map((e=>{const i=!t.hasDataSource(e);return{source:e,isMultipane:i,aboveSeries:e.zorder()>t.model().mainSeries().zorder(),paneIndex:i?r(e):s}})).sort(((e,t)=>e.isMultipane||t.isMultipane?e.isMultipane&&!t.isMultipane?t.aboveSeries?-1:1:!e.isMultipane&&t.isMultipane?e.aboveSeries?1:-1:e.paneIndex-t.paneIndex:e.source.zorder()-t.source.zorder())).map((e=>e.source))}},834905:(e,t,i)=>{i.d(t,{PriceRange:()=>n,mergePriceRanges:()=>o});var s=i(284321);const r=(0,i(77357).getLogger)("Chart.PriceRange");class n{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new n(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new n(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,s.isNumber)(e))return void r.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue);let i=this._maxValue-t,n=this._minValue-t;i*=e,n*=e,
this._maxValue=t+i,this._minValue=t+n}shift(e){(0,s.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):r.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}containPrice(e){return e>=this._minValue&&e<=this._maxValue}intersection(e){return this.containPrice(e.minValue())||this.containPrice(e.maxValue())||e.containPrice(this._minValue)?new n(Math.max(this._minValue,e.minValue()),Math.min(this._maxValue,e.maxValue())):null}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}function o(e){return e.reduce(((e,t)=>e?t?e.merge(t):e:t),null)}},331210:(e,t,i)=>{i.d(t,{convertPropertyToWatchedValue:()=>r});var s=i(168509);function r(e){const t=new s.WatchedValue(e.value());let i=!1;e.subscribe(t,(()=>{i||(i=!0,t.setValue(e.value()),i=!1)}));const r=()=>{i||(i=!0,e.setValue(t.value()),i=!1)};return t.subscribe(r),t.spawn((()=>{e.unsubscribeAll(t),t.unsubscribe(r)}))}},464303:(e,t,i)=>{i.d(t,{barSpacingByScaleRatio:()=>l,priceRangeByScaleRatio:()=>o,scaleRatio:()=>n});var s=i(834905);const r=1e-10;function n(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(r,i)}function o(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const r=e.priceRange();if(null===r||r.isEmpty())return null;const n=e.internalHeight()/(t/i),o=r.length();if(n===o)return r;const l=(n-o)/2;return new s.PriceRange(r.minValue()-l,r.maxValue()+l)}function l(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const s=i.length();return e.internalHeight()/s*t}},934:(e,t,i)=>{i.d(t,{SeriesTimeRangeVolumeCalculator:()=>s});class s{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0;const s=this._series.data().bars(),r=s.firstIndex(),n=s.lastIndex();if(null!==r&&e<r&&t<r||null!==n&&e>n&&t>n)i=NaN;else{const s=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(const e of s){const t=e.value[5];if(void 0===t){i=NaN;break}i+=t}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},536002:(e,t,i)=>{i.d(t,{generateColorCached:()=>o});var s=i(904003),r=i(275925),n=i(164680);function o(e=1e3){const t=s.default.Cache;s.default.Cache=n.CircularCacheBuffer.bind(n.CircularCacheBuffer,e);const i=(0,s.default)(r.generateColor,((e,t,i)=>`${e}_${t}_${i}`));return s.default.Cache=t,i}}}]);